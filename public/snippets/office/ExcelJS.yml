# ----------------------------
# Excel
# ----------------------------
- ENTRY:
  CATEGORY: ExcelからJSへの移植時に注意すること

- ENTRY:
  EXPLAIN: |
    関数: LOG関数名が紛らわしいので注意
  BODY: |
    Excel: LOG(X)      が10の対数を求める関数
    JS: Math.log10(X)  指定数の底が 10 の対数を返す

    Excel: NL(X)       が自然対数を求める関数
    JS: Math.log(X)    指定数の自然対数を返す

- ENTRY:
  EXPLAIN: データ型の違い
  BODY: |
    ■ 数値と文字列の自動変換

    ・Excel: 数値と文字列を自動変換（例: "123" + 1 = 124）
    ・JS: 厳密な型チェック（例: "123" + 1 = "1231"）

    ■ 日付処理

    ・Excel: 日付はシリアル値（1900年1月1日 = 1）
    ・JS: Date オブジェクトを使用（new Date()）

    ■ ブール値

    ・Excel: TRUE/FALSE
    ・JS: true/false

- ENTRY:
  EXPLAIN: 演算子の違い
  BODY: |
    ■ 文字列連結

    ・Excel: & 演算子（例: "Hello" & "World"）
    ・JS: + 演算子または concat()（例: "Hello" + "World"）


    ■ 演算子

    ・Excel: +, -, *, /, ^（べき乗）
    ・JS: +, -, *, /, **（べき乗）

    ■ 論理演算

    ・Excel: AND(), OR(), NOT()
    ・JS: &&, ||, !

    ■ 比較演算

    ・Excel: =, <>, <=, >=
    ・JS: ===, !==, <=, >= （厳密等価推奨）

- ENTRY:
  EXPLAIN: 関数とメソッドの違い
  BODY: |
    ■ 関数名の違い

    ・Excel: LEN() → JS: .length
    ・Excel: MID() → JS: .substring() または .slice()
    ・Excel: LEFT() → JS: .substring(0, n)
    ・Excel: RIGHT() → JS: .slice(-n)

    ■ 引数の順序

    ・Excel: ROUND(数値, 桁数)
    ・JS: Math.round() は四捨五入のみ、桁数指定は toFixed()

    ■ 配列操作

    ・Excel: 範囲参照（A1:B10）
    ・JS: 配列メソッド（map, filter, reduce）

- ENTRY:
  EXPLAIN: 制御構造の違い
  BODY: |
    ■ 条件分岐

    ・Excel: IF(条件, 真, 偽)
    ・JS: if-else, 三項演算子 (条件 ? 真 : 偽)

    ■ ループ

    ・Excel: 数式の自動計算（再帰的参照）
    ・JS: for, while, forEach などの明示的ループ

    ■ エラー処理

    ・Excel: IFERROR(), ISERROR()
    ・JS: try-catch, throw

- ENTRY:
  EXPLAIN: 参照と変数の違い
  BODY: |
    ■ セル参照

    ・Excel: A1, $A$1（絶対参照）
    ・JS: 変数宣言（let, const, var）

    ■ 範囲操作

    ・Excel: SUM(A1:A10)
    ・JS: 配列.reduce((sum, val) => sum + val)

- ENTRY:
  EXPLAIN: パフォーマンスと実行モデルの違い
  BODY: |
    ■ 実行タイミング

    ・Excel: 依存関係に基づく自動再計算
    ・JS: 明示的な関数呼び出し

    ■ メモリ管理

    ・Excel: スプレッドシートベース
    ・JS: ガベージコレクション

- ENTRY:
  EXPLAIN: 移植時の一般的な注意点
  BODY: |
    ■ 型変換の明示化

    ・Excel の暗黙的変換を JS で明示的に行う
    ・Number(), String(), Boolean() を使用

    ■ 境界チェック

    ・Excel は範囲外アクセスでエラーになりにくい
    ・JS は配列境界や null/undefined をチェック

    ■ 浮動小数点精度

    ・両方で注意が必要だが、JS は IEEE 754 準拠

    ■ 非同期処理

    ・Excel は同期処理のみ
    ・JS は Promise, async/await で非同期対応

- ENTRY:
  CATEGORY: search 検索

- ENTRY:
  EXPLAIN: |
    検索: vlookup
  BODY: |
    const vlookup = <T extends unknown>({
      比較値,
      lookupVector,
      比較column,
      出力column,
      searchMode = true, // default
    }: vlookup<T>) => {
      //比較値の値型により、数値か文字列比較か自動検出
      const 比較mode = /^(0|[1-9]\d*)(\.\d*)?$/.test(比較値.replace(",","")) ? "number" : "string"

      return (
        lookupVector.find((tableRow) => {
          if (比較mode === "number") {
            return searchMode
              ? Number(tableRow[比較column]) <= Number(比較値)
              : Number(tableRow[比較column]) === Number(比較値);
          } else {
            //文字列比較は完全一致のみ
            return tableRow[比較column] === 比較値;
          }
        })?.[出力column] || ""
      );
    };

    //テスト用共通引数
    const Params = {
      lookupVector: TBOM_TABLE.reverse(), //比較値：ソート済(大->小)
      比較column: "DO検索用",
      出力column: "DO値",
    } as const

    console.log("数値として比較");
    console.log(vlookup<TABLE_型>({ 比較値: "12", ...Params }));
    console.log(vlookup<TABLE_型>({ 比較値: "10", ...Params }));
    console.log(vlookup<TABLE_型>({ 比較値: "20", ...Params }));
    console.log(vlookup<TABLE_型>({ 比較値: "41", ...Params }));
    console.log(vlookup<TABLE_型>({ 比較値: "70", ...Params }));
    console.log(vlookup<TABLE_型>({ 比較値: "100", ...Params }));
    console.log(vlookup<TABLE_型>({ 比較値: "200", ...Params }));
    console.log(vlookup<TABLE_型>({ 比較値: "300", ...Params }));

    console.log("文字列として比較");

    console.log(vlookup<TABLE_型>({ 比較値: "12", ...Params, searchMode:false }));
    console.log(vlookup<TABLE_型>({ 比較値: "10", ...Params, searchMode:false }));
    console.log(vlookup<TABLE_型>({ 比較値: "20", ...Params, searchMode:false }));
    console.log(vlookup<TABLE_型>({ 比較値: "41", ...Params, searchMode:false }));
    console.log(vlookup<TABLE_型>({ 比較値: "70", ...Params, searchMode:false }));
    console.log(vlookup<TABLE_型>({ 比較値: "100", ...Params, searchMode:false }));
    console.log(vlookup<TABLE_型>({ 比較値: "200", ...Params, searchMode:false }));
    console.log(vlookup<TABLE_型>({ 比較値: "300", ...Params, searchMode:false }));
