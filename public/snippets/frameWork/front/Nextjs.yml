---
#-------------------------------
# Nextjs
#-------------------------------

- KEY: nextjs.overview
  EXPLAIN: Nextjs æ¦‚èª¬
  BODY: |
    Next.jsã‚’ä½¿ã†ã¹ã5ã¤ã®ç†ç”± + å®Ÿè£…Tips
    https://qiita.com/Yuki_Oshima/items/5c0dfd8f7af8fb76af8f

    â–  SSR/SSG
    â–  ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    â–  é–‹ç™ºã‚µãƒ¼ãƒã®éƒ¨åˆ†çš„ãªé«˜é€Ÿãƒªãƒ­ãƒ¼ãƒ‰(Fast Refresh)
    â–  ç”»åƒæœ€é©åŒ–
    â–  ã‚¼ãƒ­ã‚³ãƒ³ãƒ•ã‚£ã‚°

- KEY: nextjs.install
  EXPLAIN: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  BODY: |
    â–  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    npx create-next-app@latest          // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã® npm/yarn ä½¿ç”¨ã‚’æ±ºå®š
    yarn create next-app

    Need to install the following packages:
    create-next-app@14.2.5
    Ok to proceed? (y) y

    âˆš What is your project named? ... next13
    âˆš Would you like to use TypeScript? ... No / Yes
    âˆš Would you like to use ESLint? ... No / Yes
    âˆš Would you like to use Tailwind CSS? ... No / Yes
    âˆš Would you like to use `src/` directory? ... No / Yes
    âˆš Would you like to use App Router? (recommended) ... No / Yes
    âˆš Would you like to customize the default import alias (@/*)? ... No / Yes
    Creating a new Next.js app in B:\@Next\next_13\next13.

    Using npm.
    Initializing project with template: app-tw 

    Installing dependencies:
    - react    
    - react-dom
    - next

    Installing devDependencies:
    - typescript
    - @types/node
    - @types/react
    - @types/react-dom
    - postcss
    - tailwindcss
    - eslint
    - eslint-config-next

    Success! Created next13 at B:\@Next\next_13\next13

    â–  é–‹ç™ºç’°å¢ƒã®ç«‹ã¡ä¸Šã’
    npm run dev
    yarn dev

    â–  ãƒ–ãƒ©ã‚¦ã‚¶ç¢ºèª
    http://localhost:3000

- KEY: nextjs.package.json
  EXPLAIN: package.json
  BODY: |
    {
      "name": "next13",
      "version": "0.1.0",
      "private": true,
      "scripts": {
        "dev": "next dev",
        "build": "next build",
        "start": "next start",
        "lint": "next lint"
      },
      "dependencies": {
        "next": "14.2.5",
        "react": "^18",
        "react-dom": "^18"
      },
      "devDependencies": {
        "@types/node": "^20",
        "@types/react": "^18",
        "@types/react-dom": "^18",
        "eslint": "^8",
        "eslint-config-next": "14.2.5",
        "postcss": "^8",
        "tailwindcss": "^3.4.1",
        "typescript": "^5"
      }
    }

- KEY: nextjs.directory
  EXPLAIN: åŸºæœ¬ãƒ•ã‚¡ã‚¤ãƒ«
  BODY: |
    ./
      app/                              // Top
        dir1/                           // URL sub dir
          page.tsx                      // å„ sub dir ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒšãƒ¼ã‚¸
        globals.css                     // å…±é€šCSS
        layout.tsx                      // Root HTML
        not-found.tsx                   // 404 Error ãƒšãƒ¼ã‚¸
        page.tsx                        // Root ãƒšãƒ¼ã‚¸
      components/
        atoms/
      utilities/
      hooks/
      node_modules/                     // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
      public/                           // output
      next-env.d.ts
      next.config.mjs
      ...ãã®ä»–ã‚³ãƒ³ãƒ•ã‚£ã‚°

- KEY: nextjs.root.env
  EXPLAIN: |
    Root: .env
  BODY: |
    â–  ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰
      [.env]
      ENDPOINT='https://example.com/'

      [page.tsx]
      const endPoint = process.env.ENDPOINT || '';

    â–  ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰

      * AWSã§ã®èªè¨¼æ™‚ã«ã¯æ³¨æ„: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨

      [.env]
      NEXT_PUBLIC_ENDPOINT='https://example.com/'

      [page.tsx]
      const endPoint = process.env.NEXT_PUBLIC_ENDPOINT || '';

- KEY: nextjs.app.router.v13
  EXPLAIN: AppRouter(v13~) æ§‹æˆ
  BODY: |
    â–  13ä»¥å‰
    ./
      src/                              // Root
        â”œâ”€â”€ page.tsx                    // /
        â””â”€â”€ hello
            â”œâ”€â”€ page.tsx                // /hello?id=123
            â””â”€â”€ [id].tsx                // /hello/123

    â–  13ä»¥å¾Œ(appã®å ´åˆ)
    ./
      app/                              // Root
        â”œâ”€â”€ global-error.tsx            // Root Error Page
        â”œâ”€â”€ layout.tsx                  // Root Layout(HTML/BODY)
        â”œâ”€â”€ page.tsx                    // /
        â””â”€â”€ hello                       
            â”œâ”€â”€ error.tsx               // /hello Level Error Page
            â”œâ”€â”€ layout.tsx              // /hello Level Layout(Section)
            â”œâ”€â”€ page.tsx                // /hello?id=123
            â””â”€â”€ [id]
                â”œâ”€â”€ page.tsx            // /hello/123
                â””â”€â”€ [name]      
                    â””â”€â”€ page.tsx        // /hello/123/john

- KEY: nextjs.app.router.query
  EXPLAIN: AppRouter Query
  BODY: |
    â–  DIR: ./app/hello/page.tsx
    â–  URL: http://localhost:3000/hello?id=123
    â–  ã‚³ãƒ¼ãƒ‰
      "use client"                      // useSearchParams ã«å¿…é ˆ

      import { useSearchParams } from "next/navigation"

      export default function XXX() {   // é–¢æ•°åã¯ä»»æ„
        const searchParams = useSearchParams()
        const id = searchParams.get("id")

        return (
          <div> Hello TOP {id} </div>
        )
      }

    â–  æ³¨: "use client"

    ãƒ»useSearchParams ãªã©ã® hooks ã¯ client å´ã§ã®å®Ÿè£…ãªã®ã§ "use client" å¿…é ˆ
    ãƒ»ãªã„å ´åˆã® Error

        Ã— You're importing a component that needs useSearchParams.
        It only works in a Client Component but none of its parents are 
        marked with "use client", so they're Server Components by default.

- KEY: nextjs.app.router.dynamic.single
  EXPLAIN: AppRouter å‹•çš„Routing(å¼•æ•°-å˜æ•°)
  BODY: |
    â–  DIR: ./app/hello/[id]/page.tsx    // 13ä»¥å‰ã¨ã¯å½¢å¼ç•°ãªã‚‹
    â–  URL: http://localhost:3000/hello/123

    â–  ã‚³ãƒ¼ãƒ‰
      type Props = {
        params: { id: string }          // paramsã¯æ—¢å®šå±æ€§
      }

      export default function Hello({ params }: Props) {
        const { id } = params

        return (
          <div> Hello {id} </div>
        )
      }

- KEY: nextjs.app.router.dynamic.multiple
  EXPLAIN: AppRouter å‹•çš„Routing(å¼•æ•°-è¤‡æ•°)
  BODY: |
    â–  DIR: ./app/hello/[id]/[name]/page.tsx
    â–  URL: http://localhost:3000/hello/123/john

    â–  ã‚³ãƒ¼ãƒ‰
      type Props = {
        params: { id: string; name: string }  // paramsã¯æ—¢å®šå±æ€§
      }

      export default function Hello({ params }: Props) {
        const { id, name } = params

        return (
          <div> Hello {id} {name} </div>
        )
      }

- KEY: nextjs.app.router.dynamic.array
  EXPLAIN: AppRouter å‹•çš„Routing(å¼•æ•°-é…åˆ—) å¿…é ˆ
  BODY: |
    â–  DIR: ./app/patha/[...ids]/page.tsx            // ä¸€é‡[...å¼•æ•°]
    â–  URL: http://localhost:3000/patha/abc/123/efg  // OK: è¤‡æ•°ã®é€£ç¶šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ã‚¿
    â–  URL: http://localhost:3000/patha/             // NG: NOãƒ‘ãƒ©ãƒ¡ã‚¿

    â–  ã‚³ãƒ¼ãƒ‰
      type Props = {
        params: { ids: string[] }     // paramsã¯æ—¢å®šå±æ€§ & å¼•æ•°(ä¾‹:ids) å¿…é ˆ
      }
      export default function PathA({ params }: Props) {
        return (
          <div> PATH-A: {params.ids.join("-")} </div>
        )
      }

- KEY: nextjs.app.router.dynamic.array
  EXPLAIN: AppRouter å‹•çš„Routing(å¼•æ•°-é…åˆ—) Optional
  BODY: |
    â–  DIR: ./app/pathb/[[...ids]]/page.tsx          // äºŒé‡[[...å¼•æ•°]]
    â–  URL: http://localhost:3000/pathb/abc/123/efg  // OK: è¤‡æ•°ã®é€£ç¶šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ã‚¿
    â–  URL: http://localhost:3000/pathb/             // OK: NOãƒ‘ãƒ©ãƒ¡ã‚¿

    â–  ã‚³ãƒ¼ãƒ‰
    type Props = {
      params: { ids?: string[] }        // paramsã¯æ—¢å®šå±æ€§ & å¼•æ•°(ä¾‹:ids) Optional
    }
    export default function PathB({ params }: Props) {
      return (
        <div> PATH-B: {params.ids?.join("-") || "unknown"} </div>
      )
    }

- KEY: nextjs.layout.root
  EXPLAIN: |
    Layout: Root(HTML)
  BODY: |
    â–  Root Layout(HTML: Server Component By default)

    import type { Metadata } from "next";
    import { Inter } from "next/font/google";
    import "./globals.css";

    const inter = Inter({ subsets: ["latin"] });

    export const metadata: Metadata = {
      title: "Next Sample 13",
      description: "Generated by create next app",
    };

    export default function RootLayout({ children }: Readonly<{
      children: React.ReactNode;
    }>) {
      return (
        <html lang="ja">                // Root Level ã«ã¯ HTML & Body
          <body className={inter.className}>
            <div>Root Layout</div>
            <div>{children}</div>
          </body>
        </html>
      );
    }

- KEY: nextjs.layout.pages
  EXPLAIN: |
    Layout: Pages
  BODY: |
    â–  å„Page ã® nested Layout(Server Component By default)
    pages.tsx ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚ã‚Šã€pagesã‚’ wrap ã™ã‚‹

    export default function DashboardLayout({
      children,
    }: {
      children: React.ReactNode
    }) {
      return <section>{children}</section>
    }

- KEY: nextjs.css.global
  EXPLAIN: |
    CSS: global(Tailwind Sample)
  BODY: |
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    :root {
      --foreground-rgb: 0, 0, 0;
      --background-start-rgb: 214, 219, 220;
      --background-end-rgb: 255, 255, 255;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --foreground-rgb: 255, 255, 255;
        --background-start-rgb: 0, 0, 0;
        --background-end-rgb: 0, 0, 0;
      }
    }

    body {
      color: rgb(var(--foreground-rgb));
      background: linear-gradient(
        to bottom,
        transparent,
        rgb(var(--background-end-rgb))
      )
      rgb(var(--background-start-rgb));
    }

    @layer utilities {
      .text-balance {
        text-wrap: balance;
      }
    }

- KEY: nextjs.not.found
  EXPLAIN: |
    Not Found
  BODY: |
    â–  DIR: ./app/not-found.tsx          // Server Compo

    â–  ã‚³ãƒ¼ãƒ‰(åŒæœŸ)
      import Link from 'next/link';

      export default function NotFound() {
        return (
          <div>
            <h2>Not Found</h2>
            <Link href='/'>Return Home</Link>
          </div>
        );
      }

    â–  ã‚³ãƒ¼ãƒ‰(éåŒæœŸ)
      import Link from 'next/link'
      import { headers } from 'next/headers'
      
      export default async function NotFound() {
        const headersList = headers()
        const domain = headersList.get('host')
        const data = await getSiteData(domain)

        return (
          <div>
            <h2>Not Found: {data.name}</h2>
            <p>View <Link href="/blog">all posts</Link></p>
          </div>
        )
      }

- KEY: nextjs.error.root
  EXPLAIN: |
    ğŸ”º Error: Root
  BODY: |
    â–  Global Error(å„ªå…ˆ)

    â–  DIR: ./app/global-error.tsx       // Client Compo

- KEY: nextjs.error.pages
  EXPLAIN: |
    Error: å„Page
  BODY: |
    â–  DIR: ./app/<SUB>/error.tsx        // å„/<SUB> ä»¥ä¸‹ã® Client Compo

    "use client"                      // Client Components
    import { useEffect } from "react"

    export default function Error({ error, reset }: {
      error: Error & { digest?: string }
      reset: () => void
    }) {
      useEffect(() => {
        console.error(error)
      }, [error])

      return (
        <div>
          <h2>Local Error</h2>
          <button onClick={ ()=>reset() }>  // ReRender
            Try again
          </button>
        </div>
      )
    }

- KEY: nextjs.api
  EXPLAIN: |
    ğŸ”º API
  BODY: |

- KEY: nextjs.link
  EXPLAIN: Link(next/link)
  BODY: |
    â–  ãƒªãƒ³ã‚¯
    import Link from 'next/link';

    export default function Navbar() {  // Server Component
      return (
        <nav>
          <Link href="/about"><a>About</a></Link>
        </nav>
      );
    }

    â–  typedRoutes(v13~)                 //Routeã®å‹è£œå®Œ

    [next.config.mjs]
    /** @type {import('next').NextConfig} */
    const nextConfig = {
      experimental: {
        typedRoutes: true,
      },
    };
    export default nextConfig;

- KEY: nextjs.link.
  EXPLAIN: Link(next/link) + usePathname
  BODY: |
    â–  è‡ªèº«ã®pathå–å¾—
    'use client'                        // Client Component

    import { usePathname } from 'next/navigation'
    import Link from 'next/link'

    export function Links() {
      const pathname = usePathname()

      return (
        <nav>
          <Link className={`link ${pathname === "/" ? "active" : ""}`} href="/">
            Home/
          </Link>
          <Link
            className={`link ${pathname === "/hello" ? "active" : ""}`}
            href="/hello"
          >
            Hello/
          </Link>
        </nav>
      )
    }

- KEY: nextjs.navigation
  EXPLAIN: |
    useRouter(next/navigation: v13~)
  BODY: |
    â–  DIR: ./app/login/page.tsx
    â–  URL: http://localhost:3000/login

    â–  ã‚³ãƒ¼ãƒ‰
    "use client"                        // Hooks ã«ã¯å¿…é ˆ

        // import { useRouter } from "next/router"  â˜…DEPRECATED
        // Error: NextRouter was not mounted.

    import { useRouter } from "next/navigation"

    export default function Login() {
      const router = useRouter()

      const id = 456
      const login = () => {
        router.push(`/hello/${id}`)     //å¼•æ•°ä»˜ãã®é·ç§»
      }

      return (
        <div>
          <button onClick={login}>Log In</button>
        </div>
      )
    }
