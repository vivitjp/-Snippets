---
#-------------------------------
# Library
#-------------------------------
- ENTRY:
  CATEGORY: |
    @lukemorales/query-key-factory

- ENTRY:
  EXPLAIN: æ¦‚è¦ã¨ã‚µãƒ³ãƒ—ãƒ«
  BODY: |
    â–  æ¦‚è¦

    ãƒ»TypeScriptã§å‹å®‰å…¨ãªã‚¯ã‚¨ãƒªã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
    ãƒ»TanStack Queryï¼ˆReact Queryï¼‰ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨å¯èƒ½
    ãƒ»ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã®ä¸€è²«æ€§ã¨å†åˆ©ç”¨æ€§ã‚’å‘ä¸Šã•ã›ã‚‹
    ãƒ»GitHub: https://github.com/lukemorales/query-key-factory

    â–  ãƒ¡ã‚½ãƒƒãƒ‰

    ãƒ»createQueryKeys: ã‚¯ã‚¨ãƒªã‚­ãƒ¼ãƒ•ã‚¡ã‚¯ãƒˆãƒªã‚’ä½œæˆ
    ãƒ»createQueryKeyStore: ã‚¯ã‚¨ãƒªã‚¹ãƒˆã‚¢ã‚’ä½œæˆ
    ãƒ»queryKeys: ç”Ÿæˆã•ã‚ŒãŸã‚¯ã‚¨ãƒªã‚­ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

    â–  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

    npm install @lukemorales/query-key-factory

    â–  ã‚µãƒ³ãƒ—ãƒ«(æ·±ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )

    import { createQueryKeys } from '@lukemorales/query-key-factory';

    // eã‚³ãƒãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã®ã‚¯ã‚¨ãƒªã‚­ãƒ¼å®šç¾©ä¾‹
    const queries = createQueryKeys('ecommerce', {         // ãƒ«ãƒ¼ãƒˆã‚­ãƒ¼('ecommerce')
      products: {                                          // ã‚µãƒ–ã‚­ãƒ¼('products')
        list: (filters: ProductFilters) => [filters],      // å•†å“ãƒªã‚¹ãƒˆå–å¾—
        detail: (id: string) => [id],                      // å•†å“è©³ç´°å–å¾—
        search: (query: string) => [query],                // å•†å“æ¤œç´¢
        categories: (categoryId: string) => ({             // ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã‚­ãƒ¼
          queryKey: [categoryId],                          // queries.products.categories()
            // => ['ecommerce', 'products', 'categories', categoryId] ã¨ã„ã†æ®µéšã‚’ç¤ºã™ã‚­ãƒ¼ã«ãªã‚‹
          contextQueries: {                                // ğŸ”µ contextQueries ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            list: () => [],                                // queries.products.categories('xxx')._ctx.list()
            detail: (productId: string) => [productId],    // queries.products.categories('xxx')._ctx.detail(productId)
            featured: () => ['featured'],                  // queries.products.categories('xxx')._ctx.featured()
          },
        }),
      },
    });

    const queryClient = useQueryClient();

    // å•†å“ãƒªã‚¹ãƒˆå–å¾—
    const { data: products } = useQuery({
      queryKey: queries.products.list({ category: 'electronics', limit: 20 }),
      // ç”Ÿæˆã‚­ãƒ¼: ['ecommerce', 'products', 'list', { category: 'electronics', limit: 20 }]
      queryFn: ({ queryKey }) => fetchProducts(queryKey[1]),
    });

    // å•†å“è©³ç´°å–å¾—
    const { data: product } = useQuery({
      queryKey: queries.products.detail('product-123'),
      // ç”Ÿæˆã‚­ãƒ¼: ['ecommerce', 'products', 'detail', 'product-123']
      queryFn: ({ queryKey }) => fetchProduct(queryKey[2]),
    });

    // ã‚«ãƒ†ã‚´ãƒªå†…ã®å•†å“å–å¾—
    const { data: categoryProducts } = useQuery({
      queryKey: queries.products.categories('electronics')._ctx.detail('product-456'), // ğŸ”µ _ctx ã®ä½¿ç”¨
      // ç”Ÿæˆã‚­ãƒ¼: ['ecommerce', 'products', 'categories', 'electronics', 'detail', 'product-456']
      queryFn: () => fetchProductInCategory('electronics', 'product-456'),
    });

    // å•†å“ã‚«ãƒ†ã‚´ãƒªã®å…¨å•†å“ã‚’ğŸ”´ç„¡åŠ¹åŒ–
    queryClient.invalidateQueries({
      queryKey: queries.products.categories('electronics')._def,
      // ç”Ÿæˆã‚­ãƒ¼: ['ecommerce', 'products', 'categories', 'electronics']
    });

      â€» ç„¡åŠ¹åŒ–ã¨ã¯: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚¯ã‚¨ãƒªãƒ‡ãƒ¼ã‚¿ã‚’ç„¡åŠ¹ã«ã—ã€æ¬¡å›ã®ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«å†å–å¾—ã‚’ä¿ƒã™æ“ä½œ

- ENTRY:
  EXPLAIN: ãƒ«ãƒ¼ãƒˆã‚­ãƒ¼ã®é‹ç”¨
  BODY: |
    â–  æ¦‚è¦

    ãƒ»ãƒ«ãƒ¼ãƒˆã‚­ãƒ¼ã¯å…¨ã¦ã®ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ã—ã¦æ©Ÿèƒ½
    ãƒ»é‹ç”¨ã§ã¯åå‰ç©ºé–“ã®ç¢ºç«‹ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†ã€ãƒ‡ãƒãƒƒã‚°ã«ä½¿ç”¨

    â–  ä¸»ãªç”¨é€”

    ãƒ»ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã®æ§‹é€ åŒ–: å…¨ã¦ã®ã‚­ãƒ¼ãŒ ['ecommerce', ...] ã§å§‹ã¾ã‚‹
    ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†: ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã§ã®ç„¡åŠ¹åŒ–ãŒå¯èƒ½
    ãƒ»åå‰ç©ºé–“ã®åˆ†é›¢: ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚¯ã‚¨ãƒªã‚’åˆ†é›¢
    ãƒ»ãƒ‡ãƒãƒƒã‚°: DevToolsã§ã‚¯ã‚¨ãƒªã‚’ç‰¹å®šã—ã‚„ã™ãã™ã‚‹

      â€» ç„¡åŠ¹åŒ–ã¨ã¯: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã‚¯ã‚¨ãƒªãƒ‡ãƒ¼ã‚¿ã‚’ç„¡åŠ¹ã«ã—ã€æ¬¡å›ã®ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«å†å–å¾—ã‚’ä¿ƒã™æ“ä½œ

    â–  é‹ç”¨ä¾‹

    // ç„¡åŠ¹åŒ–: ãƒ«ãƒ¼ãƒˆã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥æ“ä½œ
    queryClient.invalidateQueries({ 
      queryKey: ['ecommerce'],  // eã‚³ãƒãƒ¼ã‚¹é–¢é€£ã®å…¨ã‚¯ã‚¨ãƒªã‚’ğŸ”´ç„¡åŠ¹åŒ–
      refetchType: 'active'     // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¯ã‚¨ãƒªã®ã¿å†å–å¾—
    });

    // ç„¡åŠ¹åŒ–: ç‰¹å®šã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã¿
    queryClient.invalidateQueries({ 
      queryKey: ['ecommerce', 'products']  // å•†å“é–¢é€£ã®ã¿ğŸ”´ç„¡åŠ¹åŒ–
    });

    // ç”Ÿæˆã•ã‚Œã‚‹ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã®ä¾‹
    queries.products.list({ category: 'electronics' })
    // => ['ecommerce', 'products', 'list', { category: 'electronics' }]

    queries.products.categories('electronics')._ctx.detail('product-123')
    // => ['ecommerce', 'products', 'categories', 'electronics', 'detail', 'product-123']

- ENTRY:
  EXPLAIN: ãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾©æ–¹æ³•
  BODY: |
    â–  æ¦‚è¦

    ãƒ»createQueryKeysé–¢æ•°ã§ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã‚’å®šç¾©ã™ã‚‹éš›ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®æ›¸ãæ–¹
    ãƒ»å¼•æ•°ä»˜ã/ãªã—ã®ãƒ¡ã‚½ãƒƒãƒ‰ã€æˆ»ã‚Šå€¤ã®å‹ï¼ˆé…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã«ã¤ã„ã¦è§£èª¬

    â–  å¼•æ•°ã‚’æˆ»ã‚Šå€¤ã®é…åˆ—ã«ç›´æ¥ä½¿ç”¨ã™ã‚‹æ›¸ãæ–¹

    ãƒ»å¿…é ˆã§ã¯ãªã„ãŒã€éå¸¸ã«ä¸€èˆ¬çš„ã§æ¨å¥¨ã•ã‚Œã‚‹æ…£ç”¨çš„ãªæ›¸ãæ–¹
    ãƒ»ç†ç”±: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯æ€§ç¢ºä¿ã®ãŸã‚ã€å¼•æ•°ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ã®å€¤ã‚’ã‚¯ã‚¨ãƒªã‚­ãƒ¼ã«å«ã‚ã‚‹ã®ãŒåŸºæœ¬
    ãƒ»TanStack Queryã§ã¯ã‚¯ã‚¨ãƒªã‚­ãƒ¼ãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è­˜åˆ¥å­ã«ãªã‚‹ãŸã‚ã€ç•°ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆ¥ã€…ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¿…è¦
    ãƒ»ä¾‹: detail: (id: string) => [id] ã§ã€idã®å€¤ãŒã‚­ãƒ¼ã«å«ã¾ã‚Œã‚‹
    ãƒ»å¿…è¦ã«å¿œã˜ã¦å¤‰æ›å¯èƒ½ï¼ˆä¾‹: detail: (id: string) => ['product', id]ï¼‰ã ãŒã€ã‚·ãƒ³ãƒ—ãƒ«ã«å¼•æ•°ã‚’è¿”ã™ã®ãŒæ¨™æº–

    â–  ãƒ¡ã‚½ãƒƒãƒ‰ã®ç¨®é¡

    1. å¼•æ•°ãªã—ãƒ¡ã‚½ãƒƒãƒ‰

       methodName: () => []

       ãƒ»å¼•æ•°ãªã—ã®ãƒ¡ã‚½ãƒƒãƒ‰
       ãƒ»è¿”ã‚Šå€¤ã¯ç©ºé…åˆ—
       ãƒ»ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼: ['rootKey', 'methodName']

    2. å¼•æ•°ä»˜ããƒ¡ã‚½ãƒƒãƒ‰

        methodName: (arg1: Type1, arg2: Type2) => [arg1, arg2]

        ãƒ»å¼•æ•°ä»˜ãã®ãƒ¡ã‚½ãƒƒãƒ‰
        ãƒ»è¿”ã‚Šå€¤ã¯å¼•æ•°ã‚’å«ã‚€é…åˆ—
        ãƒ»ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼: ['rootKey', 'methodName', arg1, arg2]

    3. contextQuerieså†…ã®ãƒ¡ã‚½ãƒƒãƒ‰

        methodName: (arg: Type) => [arg]

        ãƒ»contextQuerieså†…ã®ãƒ¡ã‚½ãƒƒãƒ‰
        ãƒ»è¿”ã‚Šå€¤ã¯å¼•æ•°ã‚’å«ã‚€é…åˆ—
        ãƒ»ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼: ['rootKey', 'parentKey', 'methodName', arg]

    â–  æˆ»ã‚Šå€¤ã®å‹

    ãƒ»é…åˆ—ï¼ˆstring[]ã‚„any[]ãªã©ï¼‰

      methodName: (arg1: Type1, arg2: Type2) => [arg1, arg2]

    ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆ{ queryKey: [...], contextQueries: {...} }ãªã©ï¼‰
      
      methodName: (arg: Type) => ({
        queryKey: [arg],
        contextQueries: {
          subMethod: (subArg: SubType) => [subArg],
        },
      })

    â–  åŸºæœ¬çš„ãªæ›¸ãæ–¹

    const queries = createQueryKeys('ecommerce', {         // ãƒ«ãƒ¼ãƒˆã‚­ãƒ¼('ecommerce')
      products: {                                          // ã‚µãƒ–ã‚­ãƒ¼('products')
        list: (filters: ProductFilters) => [filters],      // å•†å“ãƒªã‚¹ãƒˆå–å¾—
        detail: (id: string) => [id],                      // å•†å“è©³ç´°å–å¾—
        search: (query: string) => [query],                // å•†å“æ¤œç´¢
        categories: (categoryId: string) => ({             // ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã‚­ãƒ¼
          queryKey: [categoryId],                          // queries.products.categories()
            // => ['ecommerce', 'products', 'categories', categoryId] ã¨ã„ã†æ®µéšã‚’ç¤ºã™ã‚­ãƒ¼ã«ãªã‚‹
          contextQueries: {                                // ğŸ”µ contextQueries ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            list: () => [],                                // queries.products.categories('xxx')._ctx.list()
            detail: (productId: string) => [productId],    // queries.products.categories('xxx')._ctx.detail(productId)
            featured: () => ['featured'],                  // queries.products.categories('xxx')._ctx.featured()
          },
        }),
      },
    });

    â–  è§£èª¬

      list: () => []

      ãƒ»å¼•æ•°ãªã—ã®ãƒ¡ã‚½ãƒƒãƒ‰
      ãƒ»è¿”ã‚Šå€¤ã¯ç©ºé…åˆ—
      ãƒ»ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼: ['ecommerce', 'products', 'list']

      detail: (id: string) => [id],

      ãƒ»å¼•æ•°ä»˜ãã®ãƒ¡ã‚½ãƒƒãƒ‰
      ãƒ»è¿”ã‚Šå€¤ã¯idã‚’å«ã‚€é…åˆ—
      ãƒ»ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼: ['ecommerce', 'products', 'detail', id]

      search: (query: string) => [query]

      ãƒ»å¼•æ•°ä»˜ãã®ãƒ¡ã‚½ãƒƒãƒ‰
      ãƒ»è¿”ã‚Šå€¤ã¯queryã‚’å«ã‚€é…åˆ—
      ãƒ»ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼: ['ecommerce', 'products', 'search', query]

      featured: () => ['featured']                 // æˆ»ã‚Šå€¤ã®å‹ã¯ string[]

      ãƒ»contextQuerieså†…ã®å¼•æ•°ãªã—ãƒ¡ã‚½ãƒƒãƒ‰
      ãƒ»è¿”ã‚Šå€¤ã¯æ–‡å­—åˆ—é…åˆ—
      ãƒ»ç”Ÿæˆã•ã‚Œã‚‹ã‚­ãƒ¼: ['ecommerce', 'products', 'categories', categoryId, 'featured']
