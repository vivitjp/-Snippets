---
#-------------------------------
# TypeScript
#-------------------------------
- KEY: ts.typescript.category
  CATEGORY: TypeScript

- KEY: ts.TSC.tsc
  EXPLAIN: TSC
  BODY: |
    â–  TypeScript ã‚³ãƒ³ãƒ‘ã‚¤ãƒ© (TSC) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

      > npm install -g typescript

    â–  ã‚³ãƒãƒ³ãƒ‰ & ã‚ªãƒ—ã‚·ãƒ§ãƒ³

      tsc -v                            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
      tsc ãƒ•ã‚¡ã‚¤ãƒ«å.ts                  // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å®Ÿè¡Œã€å‡ºåŠ›ã¯åŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒ•ã‚¡ã‚¤ãƒ«å.js
      tsc ãƒ•ã‚¡ã‚¤ãƒ«å.ts --watch          // å¤‰æ›´ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å®Ÿè¡Œ
      tsc ãƒ•ã‚¡ã‚¤ãƒ«å.ts --noEmit         // ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®ã¿å®Ÿè¡Œã€å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç”Ÿæˆã—ãªã„
      tsc --init                        // tsconfig.json åˆæœŸåŒ–
      tsc --project tsconfig.json       // æŒ‡å®šã—ãŸ tsconfig.json ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å®Ÿè¡Œ
      tsc --build                       // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰
      tsc --build --clean               // ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ã‚¯ãƒªãƒ¼ãƒ³
      tsc --help                        // ãƒ˜ãƒ«ãƒ—è¡¨ç¤º

- KEY: ts.TSC.tsc.memory
  EXPLAIN: TSC ãƒ¡ãƒ¢ãƒªå¯¾ç­–
  BODY: |
    â–  tsc å®Ÿè¡Œæ™‚ã®ãƒ¡ãƒ¢ãƒªé–¢é€£ Node/V8 ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã€ãƒ¡ãƒ¢ãƒªè² è·ã‚’ä¸‹ã’ã‚‹ TypeScript å´ã®è¨­å®š

    â–  Node/V8 ã®ãƒ¡ãƒ¢ãƒªä¸Šé™ã‚’å¢—ã‚„ã™ï¼ˆæ¨å¥¨ï¼‰

    ãƒ»ç›´æ¥ node ã§ tsc ã‚’èµ·å‹•ï¼ˆå˜ä½ã¯ MBã€‚ä¾‹ã¯ 4GBï¼‰

      node --max-old-space-size=4096 ./node_modules/typescript/bin/tsc -p 

        é–‹ç™ºãƒ»å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: 512MB ï½ 1024MB
        ä¸­è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: 2048MB
        å¤§è¦æ¨¡ã‚¢ãƒ—ãƒª / å¤šæ•°ã®ä¾å­˜: 4096MB
        å¤§è¦æ¨¡ãƒ¢ãƒãƒ¬ãƒ / ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰: 8192MBã€œ16384MBï¼ˆãƒ›ã‚¹ãƒˆã®ç‰©ç†RAMã«ä¾å­˜ï¼‰

    ãƒ»npm ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹ï¼ˆpackage.jsonï¼‰:

      "scripts": {
        "build:ts": "node --max-old-space-size=4096 ./node_modules/typescript/bin/tsc -p tsconfig.json"
        "build:ts": "cross-env NODE_OPTIONS=--max-old-space-size=4096 npx tsc -p tsconfig.json"   // cross-env ä½¿ç”¨ä¾‹
      }

    ãƒ»ã·ã‚‰ã£ã¨ãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®å®Ÿè¡Œä¾‹:

      NODE_OPTIONS=--max-old-space-size=4096 npx tsc -p             ç’°å¢ƒå¤‰æ•°ã§æŒ‡å®šï¼ˆPOSIXï¼‰:
      $env:NODE_OPTIONS="--max-old-space-size=4096"; npx tsc -p     Windowsï¼ˆPowerShellï¼‰:
      set NODE_OPTIONS=--max-old-space-size=4096 && npx tsc -p      Windowsï¼ˆcmd.exeï¼‰:

    â–  GC / ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ç”¨ã® Node ãƒ•ãƒ©ã‚°ï¼ˆãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆæ™‚ï¼‰

    ãƒ»ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¿½è·¡:

      node --trace_gc --max-old-space-size=4096 ./node_modules/typescript/bin/tsc -p 

    ãƒ»ãƒ¡ãƒ¢ãƒªã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ / ãƒ‡ãƒãƒƒã‚¬:

      node --inspect --max-old-space-size=4096 ./node_modules/typescript/bin/tsc -p 

    â–  TypeScript å´ã§ãƒ¡ãƒ¢ãƒªè² è·ã‚’ä¸‹ã’ã‚‹è¨­å®šï¼ˆtsconfig.jsonï¼‰

      {
        "compilerOptions": {
          "skipLibCheck": true,                  // å¤–éƒ¨å‹ã®ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãƒ¡ãƒ¢ãƒª/æ™‚é–“å‰Šæ¸›
          "incremental": true,                   // å¢—åˆ†ãƒ“ãƒ«ãƒ‰ã§å†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’æ¸›ã‚‰ã™        
          "tsBuildInfoFile": ".tsbuildinfo",     // å¢—åˆ†ãƒ“ãƒ«ãƒ‰æƒ…å ±ã®ä¿å­˜å…ˆãƒ•ã‚¡ã‚¤ãƒ« 
          "composite": false                     // å¤§è¦æ¨¡ãªã‚‰ true + project references ã§åˆ†å‰²ãƒ“ãƒ«ãƒ‰ã«ã™ã‚‹           
        }
      }

    â–  é‹ç”¨ä¸Šã®è¿½åŠ Tips

      ãƒ»CI ã§ã¯ã¾ãš npx tsc --noEmitï¼ˆå‹ãƒã‚§ãƒƒã‚¯ï¼‰ã‚’èµ°ã‚‰ã›ã€å¿…è¦æ™‚ã«ãƒ¡ãƒ¢ãƒªå¢—åŠ ã‚’é©ç”¨
      ãƒ»å¤§è¦æ¨¡ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ã§ãƒ“ãƒ«ãƒ‰ã‚’åˆ†å‰²ã™ã‚‹ï¼ˆãƒ¡ãƒ¢ãƒªç¯€ç´„ï¼‹ä¸¦åˆ—åŒ–ï¼‰
      ãƒ»å¿…è¦ä»¥ä¸Šã«å¤§ããªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å‹ã‚„å·¨å¤§ãªå‹æ¼”ç®—ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©è² è·ã‚’ä¸Šã’ã‚‹ã®ã§è¦‹ç›´ã™
      ãƒ»ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼ï¼ˆOOMï¼‰ãŒå‡ºã‚‹å ´åˆã¯ã¾ãš --max-old-space-size ã‚’å¢—ã‚„ã—ã€ä½µã›ã¦ skipLibCheck ã‚’æœ‰åŠ¹åŒ–

- KEY: ts.TSC.tsc
  EXPLAIN: TSC Tips
  TABLE:
    OPTION:
      ALIGN:
        - left
        - left
      HAS_TITLE: false
      WIDTH:
        - 30%
    BODY: |
      ãƒ»ã¾ãšã¯ strict ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«	strict: true ã‚’ãƒ«ãƒ¼ãƒˆã§æœ‰åŠ¹ã«ã—ã¦å‹å“è³ªã‚’æ‹…ä¿
      ãƒ»CIã§ã¯å‹ãƒã‚§ãƒƒã‚¯ã®ã¿å®Ÿè¡Œ	npx tsc --noEmit ãƒ“ãƒ«ãƒ‰ã¨ã¯åˆ¥ã«å‹ãƒã‚§ãƒƒã‚¯ã‚’èµ°ã‚‰ã›ã‚‹ï¼ˆæ—©ãå¤±æ•—ã‚’æ¤œçŸ¥ï¼‰
      ãƒ»é–‹ç™ºæ™‚ã¯å¢—åˆ†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«	incremental: true ã¨ .tsbuildinfo ã«ã‚ˆã‚Šå†ãƒ“ãƒ«ãƒ‰ãŒé«˜é€ŸåŒ–
      ãƒ»å¤§å‹ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§ã‚’ä½¿ã†	composite: true ã¨ references ã§ä¸¦åˆ—/æ®µéšçš„ãƒ“ãƒ«ãƒ‰ãŒå¯èƒ½
      ãƒ»å¤–éƒ¨å‹ã®ãƒã‚§ãƒƒã‚¯é«˜é€ŸåŒ–	ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£å‹ã§å•é¡Œãªã‘ã‚Œã° skipLibCheck: true ã‚’è¨­å®šå‹ãƒã‚§ãƒƒã‚¯ã‚’æ—©ã‚ã‚‹
      ãƒ»Babel ç­‰ã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã™ã‚‹ãªã‚‰	isolatedModules: true ã‚’æœ‰åŠ¹ã«ã—ã¦å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã®å¤‰æ›ã«é©åˆã•ã›ã‚‹
      ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç”¨å‹å®šç¾©ã‚’å‡ºã™	ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã‚‰ declaration: true / declarationMap: true ã‚’ä½¿ã„ã€emitDeclarationOnly ã‚’æ¤œè¨
      ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«äº’æ›ã®å•é¡Œå¯¾å‡¦	esModuleInterop: true ã¨ allowSyntheticDefaultImports: true ã§ import ã®äº’æ›æ€§ã‚’æ”¹å–„
      ãƒ»ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ç®¡ç†	baseUrl + paths ã‚’ä½¿ã„ã€ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ï¼ˆwebpack/viteï¼‰å´ã§ã‚‚åŒã˜ alias ã‚’è¨­å®š
      ãƒ»å‹ã®ã¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’æ˜ç¤º	ä¸è¦ãªå®Ÿè¡Œæ™‚ã®ä¾å­˜ã‚’é¿ã‘ã‚‹ãŸã‚ import type { Foo } from 'x' ã‚’ä½¿ã†
      ãƒ»æ¼¸é€²çš„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³	allowJs: true + checkJs: false ã§ JS ã‚’ä½µç”¨ã—ã¤ã¤æ®µéšçš„ã« TS åŒ–
      ãƒ»å®Ÿè¡Œæ™‚ã® JSON å–ã‚Šè¾¼ã¿	resolveJsonModule: true ã‚’ä½¿ã†ã¨ import data from './a.json' ãŒå‹ä»˜ãã§å¯èƒ½
      ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ºæ–­	ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯ tsc --diagnostics / tsc --extendedDiagnostics ã§è§£æ
      ãƒ»ã‚¨ãƒ‡ã‚£ã‚¿/tsserver ã®è² è·å¯¾ç­–	å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ exclude ã‚’é©åˆ‡ã«è¨­å®šã—ã€typeRoots ã‚’æ•´ç†ã™ã‚‹
      ãƒ»å‹ã®ã‚³ã‚¹ãƒˆå¯¾ç­–	å·¨å¤§ãªå‹æ¼”ç®—ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«é…å»¶ã®åŸå› ã€å†—é•·ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å‹ã‚„éå¸¸ã«æ·±ã„ãƒã‚¹ãƒˆã‚’è¦‹ç›´ã™
      ãƒ»å‹æ–¹é‡ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–	tsconfig.json ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚„ãƒªãƒã‚¸ãƒˆãƒª README ã«æ¨å¥¨ãƒ«ãƒ¼ãƒ«ï¼ˆnoImplicitAny ãªã©ï¼‰ã‚’æ›¸ã„ã¦çµ±ä¸€

#-------------------------------
# Tips
#-------------------------------

- KEY: ts.Tips.category
  CATEGORY: TypeScript Tips & Snippets

#-------------------------------
# ENUM
#-------------------------------
- KEY: ts.check.ignore
  EXPLAIN: |
    ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿: å‹ãƒã‚§ãƒƒã‚¯ç„¡è¦– @ts-ignore ãªã©
  BODY: |
    // @ts-ignore
    const foo = 1

    // prettier-ignore
    const foo = {a: 1, b: { c: 2 }, d: 3, e: 4, f: 5, g: 6}  // 1è¡Œã«ã¾ã¨ã‚ã‚‹

    // eslint-disable-next-line
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    const foo = 1

#-------------------------------
# ENUM
#-------------------------------
- KEY: ts.enum.maker
  EXPLAIN: makeEnum:consté…åˆ—ã‹ã‚‰enum(Object)ä½œæˆ
  BODY: |
    function makeEnum<T extends readonly string[]>(é…åˆ—: T) {
        return é…åˆ—.filter(Boolean).reduce(
        (acc, cur) => ({ ...acc, [cur]: cur }),
        //{} as { [key in typeof é…åˆ—[number]]: string;}
        {} as Record<typeof é…åˆ—[number],string>
        );
    }

    const Enumå‹å¼ = makeEnum(["A", "B", "C", "D"] as const);
    => Enumå‹å¼: { A: string; B: string; C: string; D: string; }

#-------------------------------
# union
#-------------------------------
- KEY: ts.union.fromObject
  EXPLAIN: union ã‚’ object ã‹ã‚‰ç”Ÿæˆ
  BODY: |
    const person = {
      a: "Name",
      b: "Address",
    } as const

    type Person = typeof person[keyof typeof person]  

    çµæœ: "Name" | "Address"

- KEY: ts.union.fromArray
  EXPLAIN: union ã‚’ array ã‹ã‚‰ç”Ÿæˆ
  BODY: |
    const person = [ "Name", "Address" ] as const
    type Person = (typeof person)[number]

    çµæœ: "Name" | "Address"

#-------------------------------
# Switch
#-------------------------------
- KEY: ts.switch.never
  EXPLAIN: switchã§neverãƒã‚§ãƒƒã‚¯
  BODY: |
    export const func = (name: Person) => {
      switch (name) {
        case "Name":
          break
        case "Address":
          break
        default: {
          const _exhaustiveCheck: never = name
          throw new Error(`Switch Error: ${name}`)
        }
      }
    }

#-------------------------------
# åˆ¤åˆ¥å¯èƒ½ãªUnionå‹
#-------------------------------
- KEY: ts.unionToBranch
  EXPLAIN: åˆ¤åˆ¥å¯èƒ½ãªUnionå‹
  BODY: |
    interface Square {
      kind: "square"
      size: number
    }
    interface Rectangle {
      kind: "rectangle"
      width: number
      height: number
    }
    type Shape = Square | Rectangle

    const area = (s: Shape) => {
      switch (s.kind) {
        case "square":    return s.size * s.size
        case "rectangle": return s.width * s.height
        default:          return null
      }
    }

#-------------------------------
# é–¢æ•°ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰
#-------------------------------
- KEY: ts.overload
  EXPLAIN: é–¢æ•°ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰
  BODY: |
    interface Overloaded {
      (foo: string): string
      (foo: number): number
    }

    function stringOrNumber(foo: number): number
    function stringOrNumber(foo: string): string
    function stringOrNumber(foo: any): any {
      if (typeof foo === "number") {
        return foo * foo
      } else if (typeof foo === "string") {
        return `Hello ${foo}`
      }
    }

    // æ³¨æ„ Arrow é–¢æ•°ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ­ãƒ¼ãƒ‰ã§ããªã„

#-------------------------------
# æ§‹é€ çš„éƒ¨åˆ†å‹ã¨ãã®ä¾‹å¤–: Freshness
#-------------------------------
- KEY: ts.freshness
  EXPLAIN: æ§‹é€ çš„éƒ¨åˆ†å‹ã®ä¾‹å¤–
  BODY: |
    const foo = { x: 1, y: 2, z: 3 }
    const onlyX: { x: number } = foo //OK

    const func1 = ({ name }: { name: string }) => {
      console.log(name)
    }
    const func2 = ({ name, ...args }: { name: string; [key: string]: unknown }) => {
      console.log(name)
    }

    var person = { name: "matt", job: "officer" }
    func1(person) //æ§‹é€ çš„éƒ¨åˆ†å‹ OK
    func1({ name: "matt", job: "officer" }) //æ§‹é€ çš„éƒ¨åˆ†å‹ã®ä¾‹å¤– Object Literal: NG
    func2({ name: "matt", job: "officer" }) //OK

#-------------------------------
# å‹ã‚¬ãƒ¼ãƒ‰(in)
#-------------------------------
- KEY: ts.typeGuard.in
  EXPLAIN: å‹ã‚¬ãƒ¼ãƒ‰(in)
  BODY: |
    interface A { x: number }
    interface B { y: string }
    function typeGuardIn(q: A | B) {
      if ("x" in q) console.log(q.x)
      else console.log(q.y)
    }

#-------------------------------
# å‹ã‚¬ãƒ¼ãƒ‰
#-------------------------------
- KEY: ts.typeGuard.user
  EXPLAIN: å‹ã‚¬ãƒ¼ãƒ‰(ãƒ¦ãƒ¼ã‚¶å®šç¾©)
  BODY: |
    â–  è§£èª¬

    "is A" ã¯ã€Œæˆ»ã‚Šå€¤å´ã®å‹è¿°èªï¼ˆtype predicateï¼‰ã€

    ãƒ»é–¢æ•°ãŒ true ã‚’è¿”ã—ãŸã¨ãã«å‘¼ã³å‡ºã—å…ƒã§ arg ãŒ A ã¨è¦‹ãªã•ã‚Œã‚‹
    ãƒ»é–¢æ•°ãŒ false ã‚’è¿”ã—ãŸã¨ãã«å‘¼ã³å‡ºã—å…ƒã§ arg ãŒ A ã§ã¯ãªã„ã¨è¦‹ãªã•ã‚Œã‚‹

    â–  ã‚µãƒ³ãƒ—ãƒ«

    interface A { a: number; common: string }
    interface B { b: number; common: string }

    function isFoo(arg: any): arg is A {  // é–¢æ•°å isXxxx ã§å®šç¾©
      return arg.a !== undefined
    }

    if (isFoo(x)) {
      // ã“ã“ã§ã¯ x ã¯ A ã¨ã—ã¦æ‰±ãˆã‚‹ï¼ˆå‹ç‹­çª„ï¼‰
      console.log(x.a)
    } else {
      // ã“ã“ã§ã¯ x ã¯ A ã§ã¯ãªã„
    }

#-------------------------------
# å‹åˆ¤å®š
#-------------------------------
- KEY: ts.typeGuard.string
  EXPLAIN: å‹ã‚¬ãƒ¼ãƒ‰(æ–‡å­—åˆ—)
  BODY: |
    const isString = (value: unknown): value is string => {
      return typeof value === "string" && value !== null
    }

- KEY: ts.typeGuard.stringArray
  EXPLAIN: å‹ã‚¬ãƒ¼ãƒ‰(æ–‡å­—åˆ—é…åˆ—)
  BODY: |
    const isStringArray = (value: unknown): value is string[] => {
      return (
        typeof value === "object" &&
        value !== null &&
        Array.isArray(value) &&
        !value.some((v) => !isString(v))
      )
    }

- KEY: ts.typeGuard.object
  EXPLAIN: å‹ã‚¬ãƒ¼ãƒ‰(object)
  BODY: |
    // å…¨å±æ€§ã‚’"Optional"ã€å…¨å€¤ã¯unknownå‹ã‚’è¿”ã™
    type WouldBe<T> = { [P in keyof T]?: unknown }

    const isTypeObject = <T extends Record<string, unknown>>(
      value: unknown
    ): value is WouldBe<T> => typeof value === "object" && value !== null

- KEY: ts.typeGuard.custom
  EXPLAIN: å‹ã‚¬ãƒ¼ãƒ‰(ä»»æ„ã®å‹)
  BODY: |
    type Foo = {
      a: string
      b: number
    }
    const isFoo = (value: unknown): value is Foo =>
      isTypeObject<Foo>(value) &&
      typeof value.a === "string" &&
      typeof value.b === "number"

#-------------------------------
# Literal å‹ æ¨è«–
#-------------------------------
- KEY: ts.objectLiteral.guess
  EXPLAIN: Literalå‹æ¨è«–
  BODY: |
    function func(A: "foo") {}

    const objA = { A: "foo" }
    func(objA.A) //NG: objA.A = string

    const objB = { B: "foo" as const }
    func(objB.B) //OK

    const objC = { C: "foo" } as const
    func(objC.C) //OK

    const objD: { [key: string]: "foo" } = {
      D: "foo",
    }
    func(objD.D) //OK

#-------------------------------
# ReadOnly
#-------------------------------
- KEY: ts.readonly
  EXPLAIN: èª­ã¿å–ã‚Šå°‚ç”¨å‹
  BODY: |
    const foo: number[] = [1, 2, 3]
    foo.push(4) // OK

    const fooRO: ReadonlyArray<number> = [1, 2, 3]
    fooRO.push(4) // NG

#-------------------------------
# Utility Partial
#-------------------------------
- KEY: ts.utility.partial
  EXPLAIN: Partialå‹ã‚’ç”¨ã„ãŸObjectå‹ç”Ÿæˆ
  BODY: |
    const obj = {"A": 1, "B": 2, "C": 3};

    â–  æ„å›³ã™ã‚‹æŒ™å‹•ï¼šPartial<T>
    const objA: Partial<Record<keyof typeof obj, number>> = {
        A: 1,
        B: 2,
        //C: 3,
    }

    â–  æ„å›³ã¨ã¯ç•°ãªã‚‹æŒ™å‹•ï¼šRecord<K, T>
    const objB: Record<Partial<keyof typeof obj>, number> = {
        A: 1,
        B: 2,
        //C: 3,  <-- NG
    }

#-------------------------------
# æ’ä»–çš„ OR
#-------------------------------
- KEY: ts.exclusiveOr
  EXPLAIN: |
    æ’ä»–çš„OR -> å‚ç…§: å‹(AND/OR)
  BODY: |
    type P = { name:string, age: number }
    type A = { city:string, zip: string }

    â–  OR[ | ] ğŸ›‘ã©ã¡ã‚‰ã‹ä¸€æ–¹ã‚’æº€ãŸã™(æ’ä»–çš„ORã§ã¯ãªã„ã®ã§ä¸¡æ–¹ã§ã‚‚OK)

    const OK: P | A = { name: "Eve", age: 18 }                          // â­• P ã‚’æº€ãŸã™
    const OK: P | A = { city: "Paris", zip:"03" }                       // â­• A ã‚’æº€ãŸã™
    const OK: P | A = { name: "Eve", age: 18, city: "Paris" }           // â­• å°‘ãªãã¨ã‚‚ P ã‚’æº€ãŸã™
    const OK: P | A = { name: "Eve", age: 18, city: "Paris", zip:"03" } // â­• ä¸¡æ–¹ã‚’æº€ãŸã™
    const NG: P | A = { name: "Eve", city:"Eve" }                       // âŒ æ··ç”¨
    const NG: P | A = { city: "Paris", age: 18 }                        // âŒ æ··ç”¨

    â–  XOR ğŸ›‘æ’ä»–çš„OR(Utilityæ´»ç”¨)

    type XOR<T> = { [X in keyof T]?: never; }
    type XP = P & XOR<A>
    type XA = A & XOR<P>

    const OK: XP | XA = { name: "Eve", age: 18 }                          // â­• P ã‚’æº€ãŸã™
    const OK: XP | XA = { city: "Paris", zip:"03" }                       // â­• A ã‚’æº€ãŸã™
    const NG: XP | XA = { name: "Eve", age: 18, city: "Paris" }           // âŒ æ’ä»–çš„ OR
    const NG: XP | XA = { name: "Eve", age: 18, city: "Paris", zip:"03" } // âŒ æ’ä»–çš„ OR
    const NG: XP | XA = { name: "Eve", city:"Eve" }                       // âŒ æ··ç”¨
    const NG: XP | XA = { city: "Paris", age: 18 }                        // âŒ æ··ç”¨

#-------------------------------
# Literal Join
#-------------------------------
- KEY: ts.literal.keyJoin
  EXPLAIN: ReactHookForm ã§ã®è¤‡å±¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¯¾å¿œ
  BODY: |
    â–  ReactHookFormã§ã®KeyãŒè¤‡æ•°Keyã®åˆæˆã«ãªã£ãŸå ´åˆã®å¯¾å‡¦

    type Phases = "groupA" | "groupB";
    type Attrs = "name" | "age";

    const defaultData = {
      name: "Smith",
      age: 1,
    };
    type DefaultDataHidden = typeof defaultData;

    type Data = Partial<Record<`${Phases}.${Attrs}`, string>>;
    const data: Data = {
      "groupA.name": "John",
      "groupA.age": "Tokyo",
      "groupB.name": "Jim",
      "groupB.age": "LA",
    };

    type ErrorDataHidden = Record<
      Phases,
      Record<keyof DefaultDataHidden, { message: string }>
    >;

    const errorData: ErrorDataHidden = {
      groupA: {
        name: { message: "Must be String" },
        age: { message: "Must be Number" },
      },
      groupB: {
        name: { message: "Must be String" },
        age: { message: "Must be Number" },
      },
    };

    //-----------------------------------------------
    // Data
    //-----------------------------------------------
    {
      type DefaultData = typeof defaultData;
      type DefaultDataKeys = keyof DefaultData;

      type DataKeys = keyof typeof data;
      const phases = ["groupA", "groupB"];

      phases.forEach((phase) => {
        const keyName = "name" as DefaultDataKeys;
        const res1 = data?.[`${phase}.${keyName}` as DataKeys] || "Unknown";
        console.log(keyName, res1);
      });
    }

    //-----------------------------------------------
    // Error
    //-----------------------------------------------
    {
      type DefaultData = typeof defaultData;
      const dataKeys = Object.keys(data);

      dataKeys.forEach((key) => {
        const [phase, attr] = key.split(".");
        const res1 =
          errorData?.[phase as Phases]?.[attr as keyof DefaultData]?.message ||
          "Unknown";
        console.log(phase, attr, res1);
      });
    }
