---
#-------------------------------
# npm
#-------------------------------

- ENTRY:
  EXPLAIN: 初期化
  BODY: |
    ■ package.json 作成

    npm init                                      // 初期化
    npm init -y                                   // [-y] 全質問にYES

    ■ package.json
    {
      "name": "sample",
      "version": "1.0.0",
      "description": "sample project.",
      "main": "app.js",
      "scripts": {
        "test": "echo \"Error: no test specified\" && exit 1"
      },
      "author": "",
      "license": "ISC",
      "dependencies": {
        "webpack": "^5.31.2"
      }
    }

#-------------------------------
# package.json
#-------------------------------
- ENTRY:
  CATEGORY: package.json

- ENTRY:
  EXPLAIN: フルオプション例
  BODY: |
    {
      "name": "sample-project",                          // パッケージ名
      "version": "0.1.0",                                // セマンティックバージョン
      "description": "Example showing many package.json options",
      "private": true,                                   // 公開禁止フラグ（trueでnpm publish不可）
      "main": "dist/index.js",                           // CommonJS エントリ
      "module": "dist/index.esm.js",                     // ESM エントリ
      "types": "types/index.d.ts",                       // 型定義のパス
      "type": "module",                                  // .js を ESM として扱う
      "bin": {                                           // CLI を公開する例
        "sample-cli": "bin/cli.js"
      },
      "scripts": {                                       // よく使うスクリプト例（コメント付き）
        "build": "tsc -p tsconfig.json && rollup -c",    // ビルド（型生成＋バンドル）
        "dev": "vite",                                   // 開発サーバ
        "start": "node ./dist/index.js",                 // 本番起動コマンド
        "lint": "eslint 'src/**/*.{js,ts,tsx}'",         // Lint 実行
        "test": "jest --coverage",                       // テスト（カバレッジ付き）
        "prepublishOnly": "npm run build"                // 公開前にビルドを強制
      },
      "files": ["dist","types"],                         // パッケージに含めるファイル/ディレクトリ
      "exports": {                                       // 条件付きエクスポート（パス解決）
        ".": {
          "import": "./dist/index.esm.js",
          "require": "./dist/index.cjs.js"
        },
        "./feature": "./dist/feature.js"
      },
      "repository": {
        "type": "git",
        "url": "https://github.com/yourorg/sample-project.git"
      },
      "keywords": ["sample","example","package.json"],
      "author": "Your Name <you@example.com>",
      "license": "MIT",
      "engines": {                                         // Node / npm のバージョン制約
        "node": ">=16",
        "npm": ">=7"
      },
      "os": ["darwin","linux","win32"],                    // 動作可能なOS限定
      "cpu": ["x64","arm64"],                              // 対応アーキテクチャ
      "sideEffects": false,                                // ツリーシェイク可能か
      "dependencies": {                                    // 依存は少なめに例示
        "axios": "^1.5.0"
      },
      "devDependencies": {
        "typescript": "^5.0.0",
        "eslint": "^8.0.0",
        "jest": "^29.0.0",
        "vite": "^5.0.0"
      },
      "peerDependencies": {                                // プラグイン等で利用
        "react": "^18.0.0"
      },
      "optionalDependencies": {                            // インストール失敗しても継続
        "fsevents": "^2.0.0"
      },
      "bundledDependencies": [],                           // npm publish 時にバンドルしたいパッケージ
      "publishConfig": {                                   // npm publish の設定
        "access": "restricted",
        "registry": "https://registry.npmjs.org/"
      },
      "workspaces": ["packages/*"],                        // Monorepo 構成（任意）
      "config": {                                          // npm run から参照可能な設定
        "port": 8080
      },
      "funding": {
        "type": "github",
        "url": "https://github.com/sponsors/yourorg"
      }
    }

- ENTRY:
  EXPLAIN: name
  BODY: |
    ■ 概要

    ・パッケージ名を指定

    ■ 例

    "name": "sample-project",

    ■ ルール

    ・1-214字、英小文字、数字、記号(-._)、先頭(._以外)
    ・スコープ付の場合、@スコープ名/ というプレフィックス付
    ・コアモジュールの名前と重複不可

    ※ スコープ付: 組織やユーザ単位でパッケージを管理するための名前空間
    例: "@myorg/mypackage"

    ※ コアモジュール: Node.js の組み込みモジュール（例: fs, http, path など）

- ENTRY:
  EXPLAIN: version
  BODY: |
    ■ 概要

      パッケージのバージョンをセマンティックバージョニングで指定します。

    ■ 例

      "version": "0.1.0"

    ■ ルール

      ・major.minor.patch の形式
      ・npm の `npm version` コマンドで更新可能

      ※ セマンティックバージョニング: 互換性に基づくバージョン付与ルール

- ENTRY:
  EXPLAIN: description
  BODY: |
    ■ 概要

      ・パッケージの短い説明文。npm レジストリや検索結果に表示

    ■ 例

      "description": "Example showing many package.json options"

    ■ ルール

      ・任意項目。短く要点を記載
      ・Markdown は非サポート

- ENTRY:
  EXPLAIN: private
  BODY: |
    ■ 概要

      ・パッケージを公開したくない場合に true を指定

    ■ 例

      "private": true

    ■ ルール

      ・true の場合 `npm publish` はエラーになります（誤公開防止）

- ENTRY:
  EXPLAIN: main, module, types, type
  BODY: |
    ■ 概要

      ・main: CommonJS エントリ
      ・module: ESM エントリ
      ・types: 型定義
      ・type: .js の解釈方式

    ■ 例

      "main": "dist/index.js"
      "module": "dist/index.esm.js"
      "types": "types/index.d.ts"
      "type": "module"

    ■ ルール

      ・ESM/CJS 両対応するライブラリでは exports 併用を検討
      ・type はプロジェクト単位で設定可能（module/commonjs）

- ENTRY:
  EXPLAIN: bin
  BODY: |
    ■ 概要

      ・CLI コマンド名と実行ファイルを紐づける設定
      ・install 時に node_modules/.bin にリンクされる

    ■ 例

      "bin": { "sample-cli": "bin/cli.js" }

    ■ ルール

      ・実行ファイルはシェバン（#!/usr/bin/env node）を含める
      ・複数登録可能

- ENTRY:
  EXPLAIN: scripts
  BODY: |
    ■ 概要

      ・npm run で実行可能なタスクを定義
      ・pre/post プレフィックスでフックも指定可能

    ■ 例

      "scripts": { "build": "tsc -p tsconfig.json && rollup -c" }

    ■ ルール

      ・クロスプラットフォームに注意（シェル構文）
      ・npm-run-all や cross-env の利用を推奨

- ENTRY:
  EXPLAIN: files, exports
  BODY: |
    ■ 概要

      ・files: パッケージ化に含めるファイル
      ・exports: 条件付きエントリポイント公開設定

    ■ 例

      "files": ["dist","types"]
      "exports": { ".": {"import":"./dist/index.esm.js","require":"./dist/index.cjs.js"} }

    ■ ルール

      ・exports を使うと main より優先
      ・条件分岐で import/require を切り分け可能

- ENTRY:
  EXPLAIN: repository, keywords, author, license
  BODY: |
    ■ 概要

      ・repository: ソース管理の場所
      ・keywords: 検索用キーワード
      ・author/license は著作者とライセンス

    ■ 例

      "repository": {"type":"git","url":"https://..."}
      "keywords": ["sample","example"]
      "author": "You <you@example.com>"
      "license": "MIT"

    ■ ルール

      ・license は SPDX 形式で記載
      ・private:true の場合もライセンス記載推奨

- ENTRY:
  EXPLAIN: engines, os, cpu
  BODY: |
    ■ 概要

      ・engines: 対応 Node/npm
      ・os/cpu で動作対象を限定可能

    ■ 例

      "engines": {"node": ">=16","npm": ">=7"}
      "os": ["darwin","linux"]
      "cpu": ["x64","arm64"]

    ■ ルール

      ・engines で厳密チェックしたい場合は `engine-strict` を設定
      ・OS/CPU はパッケージ配布を制限

- ENTRY:
  EXPLAIN: sideEffects
  BODY: |
    ■ 概要

      ・モジュールが副作用を持つか否かを指定
      ・ツリーシェイキング最適化を支援

    ■ 例

      "sideEffects": false

    ■ ルール

      ・false にすると未参照のモジュールはビルド時に除去されやすくなる
      ・サイドエフェクトファイルは列挙が必要

- ENTRY:
  EXPLAIN: dependencies系
  BODY: |
    ■ 概要

      ・dependencies: 実行時依存
      ・devDependencies: 開発時依存
      ・peer: ホスト環境の依存
      ・optional: 非必須

    ■ 例

      "dependencies": {"axios":"^1.5.0"}
      "devDependencies": {"typescript":"^5.0.0"}
      "peerDependencies": {"react":"^18.0.0"}
      "optionalDependencies": {"fsevents":"^2.0.0"}

    ■ ルール

      ・依存は npm install で自動管理
      ・peerDependencies はライブラリ互換性のために宣言

- ENTRY:
  EXPLAIN: bundledDependencies, publishConfig
  BODY: |
    ■ 概要

      ・bundledDependencies: 公開時に同梱する依存
      ・publishConfig: publish の挙動設定

    ■ 例

      "bundledDependencies": ["lib"]
      "publishConfig": {"access":"restricted"}

    ■ ルール

      ・bundled を使うとレジストリに同梱されるためパッケージサイズに注意

- ENTRY:
  EXPLAIN: workspaces, config, funding
  BODY: |
    ■ 概要

      ・workspaces: Monorepo 管理
      ・config: npm run から参照する簡易設定
      ・funding: スポンサー情報

    ■ 例

      "workspaces": ["packages/*"]
      "config": {"port":8080}
      "funding": {"type":"github","url":"https://github.com/sponsors/..."}

    ■ ルール

      ・workspaces はルートで管理
      ・config は npm_package_config_* でスクリプトから参照可能

- ENTRY:
  EXPLAIN: Script 詳細
  BODY: |
    ■ 概要

    "scripts": {
      "test": "<script>"
    },

    npm run test

    ・コマンド run で実行するプロジェクト内のタスク(ビルド、テスト、ローカル実行など)を記述
    ・スクリプト自体、UNIX系では /bin/sh、Windows系では cmd.exeが実行
    ・どちらの環境でも動くようにスクリプトを記述しなければならない

    ■ scripts(シェルコマンド)

    例えば、rimraf(dir削除), mkdirp(dir生成) は script 内で利用可能

    "scripts": {
      "creat-dir": "mkdirp foo/bar",
      "remove-dir": "rimraf foo"
    },

    npm run create-dir
    npm run remove-dir

    ■ 引数 -- オプション

    npm run create-dir -- bar

    > mkdirp foo/bar "bar"  と解釈され、2つのディレクトリ作成

    /projdir/foo/bar
    /projdir/bar

    ■ pre, post プレフィックス付

    "scripts": {
      "precreat-dir": "echo \"ディレクトリ作成開始\"",
      "creat-dir": "mkdirp foo/bar",
      "postcreat-dir": "echo \"ディレクトリ作成終了\"",
    },

    ■ イベントフック

    //パッケージング
    prepare
    prepublishOnly
    publish, postpublish
    prepack
    postpack

    //インストール・アンインストール
    preinstall
    install, postinstall
    preuninstall, uninstall
    postuninstall

    //バージョニング
    preversion
    version
    postversion

#-------------------------------
# バージョンコントロール
#-------------------------------
- ENTRY:
  CATEGORY: バージョンコントロール

- ENTRY:
  EXPLAIN: バージョン管理
  BODY: |
    ■ セマンティック バージョニング(v2)              //ルール名

      major.minor.patch
      major(メジャー)                              // 互換性のない更新
      minor(マイナー)                              // 互換性保持、機能追加
      patch(パッチ)                                // 互換性保持、不具合修正

    ■ マイナー&パッチ(^: キャレット)                // 左端のゼロ以外の数字を変更しない変更を許可

      "<package名>": "^1.2.3"                     // 1.2.3以上、2.0.0未満
      "<package名>": "^0.1.2"                     // 0.1.2以上、0.2.0未満
      "<package名>": "^0.0.1"                     // 0.0.1以上、0.0.2未満

    ■ パッチ限定(~: チルダ)                        // 右端以下のバージョンがあがることを許可

      "<package名>": "~1.1.1"                     // >=1.1.1 <1.2.0
      "<package名>": "~0.1.2"                     // >=0.1.2 <0.2.0

    ■ 範囲指定記法(-: ハイフン)                     // 指定した範囲を許可(欠落部分はゼロに置換)

      "<package名>": "1.2.3 - 2.3.4"              // >=1.2.3 <=2.3.4
      "<package名>": "1.2 - 2.3.4"                // >=1.2.0 <=2.3.4

    ■ メジャー指定

      "<package名>": "1"                          // >=1.0.0 <2.0.0
      "<package名>": ""                           // >=0.0.0(全バージョン)

    ■ メジャー.マイナー指定

      "<package名>": "1.1"

    ■ フルバージョン指定

      "<package名>": "1.1.1"                      // 厳密なバージョン指定。非推薦。

#-------------------------------
# インストール
#-------------------------------
- ENTRY:
  CATEGORY: コマンド

- ENTRY:
  EXPLAIN: インストール
  BODY: |
    ■ npm i

    npm i

      package.json に記載された依存パッケージモジュールの一括インストール

    npm i <package名>                             // ローカル

      $ npm i ejs                                 // ローカルインストール
      $ npm list                                  // インストール確認

    npm i <package名>@1.1.0                       // ver指定

    npm i -g(--global) <package名>                // グローバル(要注意)

      $ npm i -g ejs                              // グローバルインストール
      $ npm list -g                               // インストール確認
      
      ejs-cli "*.ejs" --out dest/ --options data.json  //実行例:コマンドがパスなしで打てる

    npm i -S(--save) <package名>                  // デフォルト:依存関係記録

    npm i --no-save <package名>                   // 依存関係<非>記載

    npm i -D(--save-dev) <package名>              // 開発依存関係

      package.json の devDependencies に依存関係追記

    npm i -O(--save-optional) <package名>         // optionalDependencies

- ENTRY:
  EXPLAIN: インストール(バージョン指定)
  BODY: |
    ■ 概要

    ・package-lock.json 運用
    ・直接編集禁止、削除禁止
    ・npm install 時に自動生成・更新
    ・実際にインストールされたver番号情報を持つ

    ■ npm ci

    ・ci フラグによって、package-lock.json のバージョン記述を忠実に再現したインストール
    ・新規プロジェクト参加者が git clone 後の動作確認に使用

      npm cache clean --force           // キャッシュ削除(必要に応じて)
      rm -rf node_modules               // node_modules 削除
      npm ci                            // package-lock.json に忠実にインストール

- ENTRY:
  EXPLAIN: アップデート
  BODY: |
    npm update -D                                 // 全アップデート

      tag、semverを尊重して全パッケージを最新バージョン(構成で指定)に更新
      不足しているパッケージもインストール
      マイナーバージョンまで最新化

    npm audit                                     // 既知の脆弱性のレポート表示

    npm outdated                                  // 未更新のpackage確認
    npm outdated -g                               // -g グローバル

- ENTRY:
  EXPLAIN: 整合性チェック
  BODY: |
    npm cache verify

      モジュール(キャッシュ)不整合起因のエラーが疑わしい時：
      ・キャッシュの整合性チェック
      ・モジュールの再インストール

      rm -rf node_modules
      npm cache verify
      npm i                             // または npm ci

- ENTRY:
  EXPLAIN: アンインストール
  BODY: |
    npm un/uninstall <PACKAGE名>                  // 削除 
    npm un/uninstall -g <PACKAGE名>               // グローバル
    npm un/uninstall --save/-S <PACKAGE名>        // デフォルト:依存関係の削除

- ENTRY:
  EXPLAIN: コマンド実行
  BODY: |
    npm run <SCRIPT名>                            // スクリプト実行

      "scripts": {
        "mytask": "echo 'Hello World!'"
      },

    npx                                           // ローカルコマンド実行

      Node.jsのプロジェクト外のコマンド実行。PATHも汚染しない。
      v7以降は初回の実行時に可否を問うので、安全性向上。
        1)ローカル、グローバルにコマンドがあれば実行
        2)なければ、npmレジストリからダウンロードして実行
        2回目以降からはキャッシュ実行して高速化

      npx <コマンド名>
      npx -p <パッケージ名> <コマンド名>            // パッケージ名とコマンド名が異なる場合
      npx --yes <コマンド名>                       // 実行可否を問わない

- ENTRY:
  EXPLAIN: PATH 表示
  BODY: |
    npm root                            // <DRIVE>:\<WORKING_DIR>\<PACKAGE名>\node_modules
    npm root -g                         // C:\Users\<ユーザ名>\AppData\Roaming\npm\node_modules
    npm bin                             // <DRIVE>:\<WORKING_DIR>\<PACKAGE名>\node_modules\.bin
    npm bin -g                          // C:\Users\<ユーザ名>\AppData\Roaming\npm

- ENTRY:
  EXPLAIN: リスト表示
  BODY: |
    npm list(ls/la/ll)[ --all][ --depth=0]        // インストールされたパッケージリスト
    npm list <KEY>                                // KEYを含むパッケージ表示
    npm ls                                        // 依存関係をTREEで表示
    npm la                                        // パッケージ説明付き
    npm ll                                        // = la
    npm dedupe                                    // 構造を単純化して表示

      --all            デフォルトで全表示
      --depth=0        オプションで依存関係の深さを表示
          0: パッケージ依存ツリーのトップのみ
          1: 1段目のパッケージまで,...

    npm list -g                                   // PATHとグローバル パッケージ

- ENTRY:
  EXPLAIN: 他コマンドリスト
  BODY: |
    npm access                                    // 公開packageのアクセスレベル設定
    npm adduser                                   // レジストリユーザーアカウント追加
    npm bugs                                      // Webブラウザのpackageのバグ
    npm completion                                // タブ補完
    npm config                                    // 構成ファイル管理
    npm deprecate                                 // packageのバージョンを非推奨
    npm diff                                      // レジストリdiffコマンド
    npm dist-tag                                  // package配布タグを変更
    npm docs                                      // Webブラウザのpackageのドキュメント
    npm doctor                                    // 環境確認
    npm edit                                      // インストールpackage編集
    npm exec                                      // packageからコマンド実行
    npm explain                                   // インストールpackage説明
    npm explore                                   // インストールpackage参照
    npm find-dupes                                // packageツリーで重複検索
    npm fund                                      // 資金調達情報を取得
    npm help                                      // ヘルプドキュメント検索
    npm help-search                               // ヘルプ検索
    npm hook                                      // レジストリフック管理
    npm install-ci-test                           // バージョン厳守インストールテスト
    npm install-test                              // packageインストールテスト
    npm link                                      // packageフォルダをシンボリックリンク
    npm logout                                    // レジストリからログアウト
    npm org                                       // 組織管理
    npm owner                                     // package所有者管理
    npm pack                                      // packageからtarball作成
    npm ping                                      // レジストリにping
    npm prefix                                    // プレフィックスを表示
    npm profile                                   // レジストリプロファイル設定変更
    npm prune                                     // 無関係なpackage削除
    npm publish                                   // ●packageを公開
    npm rebuild                                   // ●packageを再構築
    npm repo                                      // ブラウザでpackageリポジトリページを開く
    npm restart                                   // package再起動
    npm run-script                                // 任意のpackageスクリプト実行
    npm search                                    // ●パッケージ検索
    npm set-script                                // package.json の script でタスク設定
    npm shrinkwrap                                // 公開用に依存関係のverをロック
    npm star                                      // お気に入りのpackageにマーク
    npm stars                                     // お気に入りとしてpackage表示
    npm start                                     // package開始
    npm stop                                      // package停止
    npm team                                      // 組織チーム管理
    npm test                                      // packageテスト
    npm token                                     // 認証トークン管理
    npm unpublish                                 // ●レジストリからpackage削除
    npm unstar                                    // お気に入りpackageから削除
    npm version                                   // package ver
    npm view                                      // ●レジストリ情報
    npm whoami                                    // npmユーザー名表示
