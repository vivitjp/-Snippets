---
#-------------------------------
# Amplify フロントエンド
#-------------------------------
- ENTRY:
  CATEGORY: 概説

- ENTRY:
  EXPLAIN: フロントエンド インストール
  BODY: |
    ■ Frontend: Amplify Framework のインストール

      > npm install aws-amplify

    ■ React Native

      > npm install aws-amplify @react-native-async-storage/async-storage

- ENTRY:
  EXPLAIN: 設定ファイル
  BODY: |
    ■ aws-exports.js

      ・amplify init や amplify add <category> コマンド実行時に自動生成
      ・AWSリソースの設定情報（リージョン、ID、エンドポイントなど）を含む
      ・プロジェクトルート直下に生成されることが多い
      ・フロントエンドコードでインポートして使用

        import Amplify from 'aws-amplify'
        import awsconfig from './aws-exports'

        Amplify.configure(awsconfig)

    ■ 詳細

- ENTRY:
  CATEGORY: Amplify CLI（Frontend）

- ENTRY:
  EXPLAIN: フロントエンド基本コマンド一覧
  BODY: |
    ■ 初期化

      Amplify.configure(config)         aws-exports.js を読み込み初期化

    ■ Auth

      Auth.signUp                       ユーザー登録
      Auth.signIn                       ログイン
      Auth.signOut                      ログアウト
      Auth.currentAuthenticatedUser     現在の認証ユーザー取得

    ■ API

      API.get                           GETリクエスト
      API.post                          POSTリクエスト
      API.put                           PUTリクエスト
      API.del                           DELETEリクエスト

    ■ Storage

      Storage.put                       ファイルアップロード
      Storage.get                       ファイルダウンロード
      Storage.remove                    ファイル削除
      Storage.list                      ファイル一覧取得

    ■ DataStore

      DataStore.save                    データ保存
      DataStore.query                   データクエリ
      DataStore.delete                  データ削除
      DataStore.observe                 データ変更監視

    ■ Analytics

      Analytics.record                  イベント記録
      Analytics.updateEndpoint          エンドポイント更新

    ■ Predictions

      Predictions.convert               変換処理
      Predictions.identify              識別処理
      Predictions.interpret             解釈処理

    ■ PubSub

      PubSub.publish                    メッセージ公開
      PubSub.subscribe                  メッセージ購読

- ENTRY:
  EXPLAIN: API
  BODY: |
    import { API } from 'aws-amplify'

    ■ GET

    API.get('myApiName', '/items', {
      queryStringParameters: {
        limit: 10,
        sort: 'desc'
      }
    }).then(response => {
      console.log(response)
    })

    ■ POST

    API.post('myApiName', '/items', {
      body: { name: '新規アイテム' }
    }).then(response => {
      console.log(response)
    })

    ■ PUT

    API.put('myApiName', '/items/123', {
      body: { name: '更新アイテム' }
    }).then(response => {
      console.log(response)
    })

    ■ DELETE

    API.del('myApiName', '/items/123').then(response => {
      console.log(response)
    })

- ENTRY:
  EXPLAIN: サンプル(React & GraphQL)
  BODY: |
    import { API, graphqlOperation } from 'aws-amplify'
    import { createItem, updateItem, deleteItem } from './graphql/mutations'
    import { getItem, listItems } from './graphql/queries'

    ■ Create
    const newItem = { name: '新規アイテム' }
    API.graphql(graphqlOperation(createItem, { input: newItem })).then(response => {
      console.log(response)
    })

        ■ createItem の実装例
        export const createItem = /* GraphQL */ `
          mutation CreateItem($input: CreateItemInput!) {
            createItem(input: $input) {
              id
              name
              createdAt
              updatedAt
            }
          }

    ■ Read (Single)
    API.graphql(graphqlOperation(getItem, { id: '123' })).then(response => {
      console.log(response)
    })

        ■ getItem の実装例
        export const getItem = /* GraphQL */ `
          query GetItem($id: ID!) {
            getItem(id: $id) {
              id
              name
              createdAt
              updatedAt
            }
          }
        `

    ■ Read (List)
    API.graphql(graphqlOperation(listItems)).then(response => {
      console.log(response)
    })

        ■ listItems の実装例
        export const listItems = /* GraphQL */ `
          query ListItems {
            listItems {
              items {
                id
                name
                createdAt
                updatedAt
              }
            }
          }
        `

    ■ Update
    const updatedItem = { id: '123', name: '更新アイテム' }
    API.graphql(graphqlOperation(updateItem, { input: updatedItem })).then(response => {
      console.log(response)
    })

        `
        ■ updateItem の実装例
        export const updateItem = /* GraphQL */ `
          mutation UpdateItem($input: UpdateItemInput!) {
            updateItem(input: $input) {
              id
              name
              createdAt
              updatedAt
            }
          }
        `

    ■ Delete
    API.graphql(graphqlOperation(deleteItem, { input: { id: '123' } })).then(response => {
      console.log(response)
    })

        ■ deleteItem の実装例
        export const deleteItem = /* GraphQL */ `
          mutation DeleteItem($input: DeleteItemInput!) {
            deleteItem(input: $input) {
              id
            }
          }
        `

- ENTRY:
  EXPLAIN: サンプル(DataStore)
  BODY: |
    import { DataStore } from 'aws-amplify'
    import { Item } from './models'

      export const Item = {
        name: 'Item',
        fields: {
          id: { type: 'ID', isRequired: true },
          name: { type: 'String', isRequired: true },
          createdAt: { type: 'AWSDateTime', isRequired: false },
          updatedAt: { type: 'AWSDateTime', isRequired: false }
        }
      }

      ※ amplify codegen models で自動生成
      GraphQLスキーマ例:
        type Item @model {
          id: ID!
          name: String!
          createdAt: AWSDateTime
          updatedAt: AWSDateTime
        }

    ■ 保存（Create）
    const newItem = await DataStore.save(
      new Item({ name: '新規アイテム' })
    )

    ■ 取得（Query）
    const items = await DataStore.query(Item)
    console.log(items)

    ■ 削除（Delete）
    await DataStore.delete(items[0])

    ■ 変更監視（Observe）
    データモデル（例: Item）に対して追加・更新・削除などの変更イベントをリアルタイムで検知
    - 他ユーザーや他端末でデータが変更された時にUIを自動更新
    - オフライン/オンライン同期時の変更検知
    - リアルタイム通知や履歴管理

      const subscription = DataStore.observe(Item).subscribe(msg => {
        // msg.model: モデル名
        // msg.opType: 操作種別（INSERT, UPDATE, DELETE）
        // msg.element: 変更されたデータ
        console.log('変更検知:', msg)
      })

    ■ 購読解除
    subscription.unsubscribe()

- ENTRY:
  EXPLAIN: サンプル(DataStore React Subscribe使用)
  BODY: |
    ■ subscribeあり：他端末や他ユーザーによる変更もリアルタイム反映
    import React, { useEffect, useState } from 'react'
    import { DataStore } from 'aws-amplify'
    import { Item } from './models'

    const ItemList = () => {
      const [items, setItems] = useState([])

      // データ取得
      useEffect(() => {
        DataStore.query(Item).then(setItems)
        // 変更監視
        const subscription = DataStore.observe(Item).subscribe(msg => {
          DataStore.query(Item).then(setItems)
        })
        return () => subscription.unsubscribe()
      }, [])

      // 新規作成
      const addItem = async () => {
        await DataStore.save(new Item({ name: '新規アイテム' }))
        const updated = await DataStore.query(Item)
        setItems(updated)
      }

      // 削除
      const deleteItem = async (item) => {
        await DataStore.delete(item)
        const updated = await DataStore.query(Item)
        setItems(updated)
      }

      return (
        <div>
          <button onClick={addItem}>追加</button>
          <ul>
            {items.map(item => (
              <li key={item.id}>
                {item.name}
                <button onClick={() => deleteItem(item)}>削除</button>
              </li>
            ))}
          </ul>
        </div>
      )
    }

    export default ItemList

- ENTRY:
  EXPLAIN: サンプル(DataStore React Subscribe不使用)
  BODY: |
    ■ subscribeなし：自分の操作（追加・削除）時のみ再取得・反映。外部変更は反映されない

    import React, { useEffect, useState } from 'react'
    import { DataStore } from 'aws-amplify'
    import { Item } from './models'

    const ItemList = () => {
      const [items, setItems] = useState([])

      // データ取得（初回のみ）
      useEffect(() => {
        DataStore.query(Item).then(setItems)
      }, [])

      // 新規作成
      const addItem = async () => {
        await DataStore.save(new Item({ name: '新規アイテム' }))
        const updated = await DataStore.query(Item)
        setItems(updated)
      }

      // 削除
      const deleteItem = async (item) => {
        await DataStore.delete(item)
        const updated = await DataStore.query(Item)
        setItems(updated)
      }

      return (
        <div>
          <button onClick={addItem}>追加</button>
          <ul>
            {items.map(item => (
              <li key={item.id}>
                {item.name}
                <button onClick={() => deleteItem(item)}>削除</button>
              </li>
            ))}
          </ul>
        </div>
      )
    }

    export default ItemList
