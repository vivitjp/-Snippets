---
#-------------------------------
# AWS
#-------------------------------
- KEY: aws.S3.category
  CATEGORY: S3(Simple Storage Service)

- KEY: aws.S3.概要
  EXPLAIN: |
    概要
  BODY: |
    • オブジェクトストレージサービス
    • データを「オブジェクト」として保存
    • オブジェクトは「バケット」に格納される
    • バケットはAWSリージョン内で一意な名前を持つ
    • バケットはグローバルで一意な名前を持つ

    ■ 耐久性 & 可用性
      • S3 のデータ耐久性はイレブンナイン(99.999999999%)(耐久性)
         • 自動的に 同リージョン内の 3AZ 以上にバックアップ
         • リージョン障害時にはアクセスできない
      • 可用性は 99.99 %(稼働)

    ■ オブジェクトキー
      • オブジェクトキー名は「バケット名/オブジェクト名」で指定
      • 例: 「BucketName/Project/Word123.txt」
            Project/WordFiles: プレフィックス
            123.txt: オブジェクト名
      • マネジメントコンソールではフォルダのような階層で表示
      • 実際は「階層」は存在せず、「/」区切りのプレフィックスをグループ化(「フォルダ」概念)して表示

- KEY: aws.S3.VPCからアクセスパターン
  EXPLAIN: |
    VPCからアクセスパターン
  BODY: |
    ■ 1.EC2（パブリックサブネット）> Internet Gateway
      • PublicSubnet から InternetGateway 経由で S3 にアクセス
    ┌─────────────────────────────────────────────────┐
    │ AWS Cloud                                       │
    │ ┌─────────────────────────────────────────────┐ │
    │ │ Region                                      │ │
    │ │  ┌──────────────────────────┐               │ │
    │ │  │ VPC                      │               │ │
    │ │  │ ┌────────────────┐ ┌─────┴────┐ ┌──────┐ │ │
    │ │  │ │ Public Subnet  ├─┤ Internet ├─┤  S3  │ │ │
    │ │  │ │     [EC2]      │ │ Gateway  │ └──────┘ │ │
    │ │  │ └────────────────┘ └─────┬────┘          │ │
    │ │  │ ┌────────────────┐       │               │ │
    │ │  │ │ Private Subnet │       │               │ │
    │ │  │ │                │       │               │ │
    │ │  │ └────────────────┘       │               │ │
    │ │  └──────────────────────────┘               │ │
    │ └─────────────────────────────────────────────┘ │
    └─────────────────────────────────────────────────┘

    ■ 2.EC2（プライベートサブネット）> NAT Gateway
      • PrivateSubnet から NAT Gateway/InternetGateway 経由で S3 にアクセス(コスト高)
    ┌──────────────────────────────────────────────────┐
    │ AWS Cloud                                        │
    │ ┌──────────────────────────────────────────────┐ │
    │ │ Region                                       │ │
    │ │  ┌───────────────────────────┐               │ │
    │ │  │ VPC                       │               │ │
    │ │  │ ┌─────────────────┐ ┌─────┴────┐ ┌──────┐ │ │
    │ │  │ │ Public Subnet   │ │ Internet ├─┤  S3  │ │ │
    │ │  │ │ ┌─────────────┐ │ │ Gateway  │ └──────┘ │ │
    │ │  │ │ │ NAT Gateway ├─┼─┤          |          │ │
    │ │  │ │ └──────┬──────┘ │ │          │          │ │
    │ │  │ └────────│────────┘ └─────┬────┘          │ │
    │ │  │ ┌────────│────────┐       │               │ │
    │ │  │ │      [EC2]      │       │               │ │
    │ │  │ │ Private Subnet  │       │               │ │
    │ │  │ └─────────────────┘       │               │ │
    │ │  └───────────────────────────┘               │ │
    │ └──────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────┘

    ■ 3.EC2（プライベートサブネット）> VPC Endpoint(Gatewayタイプ)
      • PrivateSubnet から VPC Endpoint(Gateway)経由で S3 にアクセス(コスト無)
      • アクセスは【グローバルIP】
    ┌──────────────────────────────────────────────────┐
    │ AWS Cloud                                        │
    │ ┌──────────────────────────────────────────────┐ │
    │ │ Region                                       │ │
    │ │  ┌───────────────────────────┐               │ │
    │ │  │ VPC                       │               │ │
    │ │  │ ┌─────────────────┐       │               │ │
    │ │  │ │ Public Subnet   │       │               │ │
    │ │  │ └─────────────────┘       │               │ │
    │ │  │ ┌─────────────────┐ ┌─────┴────┐ ┌──────┐ │ │
    │ │  │ │ Private Subnet  ├─┤ VPC      ├─┤  S3  │ │ │
    │ │  │ │      [EC2]      │ │ Endpoint │ └──────┘ │ │
    │ │  │ │                 │ │ Gateway  │          │ │
    │ │  │ └─────────────────┘ └─────┬────┘          │ │
    │ │  └───────────────────────────┘               │ │
    │ └──────────────────────────────────────────────┘ │
    └──────────────────────────────────────────────────┘

    ■ 4.EC2（プライベートサブネット）> VPC Endpoint(Interfaceタイプ)
      • PrivateSubnet から VPC Endpoint(Interface)経由で S3 にアクセス(コスト発生)
      • アクセスは【プライベートIP】
    ┌───────────────────────────────────────────────────┐
    │ AWS Cloud                                         │
    │ ┌───────────────────────────────────────────────┐ │
    │ │ Region                                        │ │
    │ │  ┌───────────────────────────┐                │ │
    │ │  │ VPC                       │                │ │
    │ │  │ ┌─────────────────┐       │                │ │
    │ │  │ │ Public Subnet   │       │                │ │
    │ │  │ └─────────────────┘       │                │ │
    │ │  │ ┌─────────────────┐ ┌─────┴─────┐ ┌──────┐ │ │
    │ │  │ │ Private Subnet  ├─┤ VPC       ├─┤  S3  │ │ │
    │ │  │ │      [EC2]      │ │ Endpoint  │ └──────┘ │ │
    │ │  │ │                 │ │ Interface │          │ │
    │ │  │ └─────────────────┘ └─────┬─────┘          │ │
    │ │  └───────────────────────────┘                │ │
    │ └───────────────────────────────────────────────┘ │
    └───────────────────────────────────────────────────┘

- KEY: aws.S3.category.実装
  CATEGORY: 実装

- KEY: aws.S3.実装.作成
  EXPLAIN: |
    S3バケットの作成
  BODY: |
    ■ S3バケットの作成
      • リージョン
        • バケット作成リージョン指定
      • パケットタイプ
        • 汎用: 通常のストレージ
        • ディレクトリ: ディレクトリストレージ(低レイテンシー)
      • バケット名
        • グローバルで一意な名前を指定
        • バケット名=DNS名(DNSルールに従う)
          • 小文字の英字、数字、ハイフン(-)のみで、3～63文字
          • ハイフンでの始終端は不可で、連続したハイフンは使用不可
      • パブリックアクセスブロック(デフォルト)
        • パブリックアクセスのブロックを構成する4つの設定はドキュメント参照
