---
#-------------------------------
# EC2
#-------------------------------
- ENTRY:
  CATEGORY: 概論

- ENTRY:
  EXPLAIN: |
    マシンスペック
  BODY: |
    ■ インスタンスの種類
      • 汎用インスタンス
        • T  (バースト)
        • M  (汎用)
        • A  (Arm)
        • Mac
      • コンピューティング最適化
        • C  (コンピューティング)
      • ストレージ最適化
        • I  (低レイテンシー)
        • D  (ローカルストレージ) 
        • H  (ローカルストレージ/コンピューティング)
      • メモリ最適化
        • R  (メモリ最適化)
        • X  (大規模アプリケーション)
        • ハイメモリ(メインメモリDB)
        • Z  (高周波コア/ハイメモリ)
      • 高速コンピューティング
        • P  (GPU)
        • DL1(Gaudiアクセラレーター)
        • Inf(Infarentia ML推論チップ)
        • G  (グラフィック集約)
        • F  (FPGA)
        • VT (ビデオトランスコーディング)

    ■ CUPの種類
      • Intel Xeon Scalableプロセッサー
        • 2.5GHzの最大周波数
        • AVX-512命令セット
        • Intel Turbo Boost Technology 2.0
        • Intel Deep Learning Boost (DL Boost)
      • AMD EPYCプロセッサー
        • 3.0GHzの最大周波数
        • AVX2命令セット
      • AWS Gravitonプロセッサー
        • Armアーキテクチャベースのカスタムプロセッサー

    ■ インスタンスサイズ
      • CPUクロック
      • メモリ
      • ネットワーク帯域幅

- ENTRY:
  EXPLAIN: |
    EBS(Amazon Elastic Block Store)
  BODY: |
    • EC2インスタンスにネットワーク経由で接続するブロックストレージ
    • アプリケーションを問わず様々ワークロードで利⽤可能
    • ⼤きく４つのボリュームタイプがあり
      • SSD HDD 性能や得意ワークロードで選択可能
    • EBSの1ボリュームサイズ〜16TB
      • io2 Block Expressのみ64TBまで可能
    • 最⼤IOPS/ボリューム256,000
      • 最⼤スループット/ボリューム7,500 MB/s

    注意:
    • EBSはEC2インスタンスに接続している間のみ課金される
    • EC2インスタンスを停止してもEBSは課金される

- ENTRY:
  EXPLAIN: |
    AMI(Amazon Machine Image)
  BODY: |
    • EC2はAWSが提供するOSを含む、幅広い種類のマシンイメージ(AMI)で構築
    • 各種設定を⼊れるだけで5分程で構築完了
    • インストール作業不要
    • Windows、Linux、RHEL、SUSE、Ubuntu、Debian、Amazon Linuxなど
    • AWS Marketplaceを活⽤することでソフトウェアを含んだ環境もAMIから構築可能
    • 5000+あるAMIから特定のソフトウェアを含んだ環境を簡単に構築できる

- ENTRY:
  EXPLAIN: |
    利用、停止、スケーリング
  BODY: |
    開始: EC2 パラメタ設定し、インスタンス起動
          課金: インスタンスの起動時から課⾦が発⽣
    停止: EC2 インスタンス停止
          利⽤時間の課⾦は発⽣するが、ストレージの課⾦は発⽣しない
          EBSボリュームは課⾦が発⽣する
    終了: EC2 インスタンス削除
          課⾦: 課金されない。ただし、EBSボリュームは課⾦が発⽣する

    ■ 垂直スケーリング
    • サーバのデータ移動不要で、CPU、メモリの拡張と縮⼩

    ■ 水平スケーリング
    • EC2インスタンスを追加し、負荷分散を実施

#-------------------------------
#  構築からアクセス
#-------------------------------
- ENTRY:
  CATEGORY: 構築からアクセス

- ENTRY:
  EXPLAIN: |
    EC2インスタンス作成
  BODY: |
    ■ EC2のページを開く
    • ダッシュボード画面から「インスタンスを起動」を選択
      • 無料枠の[Amazon Linux 2 AMI (HVM), SSD Volume Type]を利用
    • インスタンスタイプの選択
      • t2.microを選択
      • [次のステップ：インスタンスの詳細の設定]をクリック
    • インスタンスの詳細の設定
      • 「誤った終了を防止します」をONにする
      • [次のステップ:ストレージの追加]をクリック
    • ストレージの追加
      • サイズ: 8GB
      • ボリュームタイプ: 汎用SSD(gp2)
      • EC2インスタンス終了時にEBSも削除するにチェックを入れる
      • [次のステップ:タグの追加]をクリック
    • タグの追加  
      • タグは特に必要ないので、[次のステップ:セキュリティグループの設定]をクリック
    • セキュリティグループの設定
        • EC2インスタンスに対するアクセス制御ファイアウォール
        • [ルールの追加]をクリック
          • SSH, HTTP, HTTPSを選択
          • ソース: カスタム 0.0.0.0 でOK
          • [確認と作成]をクリック
    • インスタンスの作成と確認
      • [作成]をクリック

    ■ ウィンドウ画面[既存のキーペアを選択するか、新しいキーペアを作成します。]
      ① 「新しいキーペアの作成」を選択
      ② キーペア名を入力 例: test-keypair
      ③ キーペア(*.pem)のダウンロード
        • ダウンロードしたキーペアは、EC2インスタンスにSSH接続する際に必要
        • ダウンロードしたキーペアは、他の人と共有しないこと
        • キーペアは、EC2インスタンスを起動する際に必要なため、必ず保存しておくこと 
      ④ [インスタンスの作成]をクリック

    ■ 画面[作成ステータス]
      • インスタンスの作成が完了するまで待機
      • 状態が「pending」の場合は、作成中
      • 状態が「running」になったら、作成完了
      • [インスタンスの表示]をクリック

    ■ 画面[インスタンスの詳細]
      • リスト(インスタンスID、状態、パブリックIPアドレスなど)表示
      • インスタンスの状態が「running」になっていることを確認 
      • [インスタンスID]をクリック

    ■ 画面[XXXXXインスタンスの概要]
      • 個々のインスタンスの詳細情報を表示
        • インスタンスID
        • 状態
        • パブリックIPアドレス
        • プライベートIPアドレス
        • セキュリティグループ
        • AMI IDなど
      • [接続]をクリック

    ■ 画面[インスタンスに接続]
      • インスタンスID [XXXXXX]
      • SSHクライアントを開きます。
        • Windows: PuTTY
        • Mac: ターミナル
      • 作業場所にプライベートキーファイル(pem)を保存
      • プライベートキーファイルのパーミッションを変更(セキュリティ)
        • chmod 400 test-keypair.pem
      • 使用中のインスタンスのパブリックIPアドレスをコピー
      • SSHでインスタンスに接続
        • ssh -i "test-keypair.pem" ec2-user@<Public IP Address>
        • ユーザ名: ec2-user は Amazon Linux 2 のデフォルトユーザ名
          • ユーザ名は、AMIの種類によって異なる場合がある
            • Amazon Linux 2: ec2-user
            • Ubuntu: ubuntu
            • RHEL: ec2-user または root
            • SUSE: ec2-user または root
            • Debian: admin または root

    ■ ターミナル
      $ chmod 400 myaccesskey.pem
      $ ssh -i "myaccesskey.pem" ec2-user@ec2-00-000-000-000.ap-northeast-1.compute.amazonaws.com

            __|  __|_  )
            _|  (     /   Amazon Linux 2 AMI
            ___|\___|___|

      https://aws.amazon.com/amazon-linux-2/
      2 package(s) needed for security, out of 5 available
      Run "sudo yum update" to apply all updates.

    ■ アップデート
      • 実行 "sudo yum update"

    ■ 停止
      • 実行 "sudo shutdown -h now"
      • インスタンスの状態が「stopped」になっていることを確認
      • [インスタンスID]をクリック

#-------------------------------
#  SDK
#-------------------------------
- ENTRY:
  CATEGORY: SDK

- ENTRY:
  EXPLAIN: |
    keyPair 取得(describe)
  BODY: |
    ■ 現在の AWS アカウント内のすべてのキーペアを一覧表示

    import { DescribeKeyPairsCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * @param {{ dryRun: boolean }}      // 確認のみ(反映しない)
    */
    export const main = async ({ dryRun }) => {
      const client = new EC2Client({});
      const command = new DescribeKeyPairsCommand({ DryRun: dryRun });

      try {
        const { KeyPairs } = await client.send(command);
        const keyPairList = KeyPairs.map(
          (kp) => ` • ${kp.KeyPairId}: ${kp.KeyName}`,
        ).join("\n");
        console.log(keyPairList);       // キーペアの一覧表示
      } catch (caught) {
        if (caught instanceof Error && caught.name === "DryRunOperation") {
          console.log(`${caught.message}`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    keyPair 作成(create)
  BODY: |
    ■ EC2インスタンスにSSH接続するためのキーペアを作成

    import { CreateKeyPairCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * 指定名前と指定 PEM or PPK 形式で ED25519 or 2048bit の RSAキーペア 作成
    * Amazon EC2 は「公開キー」を保存し、ファイルに保存するための「秘密キー」を表示
    * @param {{ keyName: string }} options
    */
    export const main = async ({ keyName }) => {
      const client = new EC2Client({});
      const command = new CreateKeyPairCommand({
        KeyName: keyName,
      });

      try {
        const { KeyMaterial, KeyName } = await client.send(command);
        console.log(KeyName);           // キーペア名
        console.log(KeyMaterial);       // 秘密キー 
      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidKeyPair.Duplicate") {
          console.warn(`${caught.message}. Try another key name.`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    keyPair 削除(delete)
  BODY: |
    ■ Amazon EC2 から公開キーを削除して、指定されたキーペアを削除

    import { DeleteKeyPairCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * @param {{ keyName: string }} options
    */
    export const main = async ({ keyName }) => {
      const client = new EC2Client({});
      const command = new DeleteKeyPairCommand({
        KeyName: keyName,
      });

      try {
        await client.send(command);
        console.log("削除完了");
      } catch (caught) {
        if (caught instanceof Error && caught.name === "MissingParameter") {
          console.warn(`${caught.message}. Did you provide the required value?`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    SecurityGroups 取得(describe)
  BODY: |
    ■ 指定セキュリティグループ or 全セキュリティグループ取得

    import { DescribeSecurityGroupsCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * @param {{ groupIds: string[] }} options
    */
    export const main = async ({ groupIds = [] }) => {
      const client = new EC2Client({});
      const command = new DescribeSecurityGroupsCommand({
        GroupIds: groupIds,
      });

      try {
        const { SecurityGroups } = await client.send(command);
        const sgList = SecurityGroups.map(
          (sg) => `• ${sg.GroupName} (${sg.GroupId}): ${sg.Description}`,
        ).join("\n");
        
        if (sgList.length) {
          console.log(`Security groups:\n${sgList}`);
        } else {
          console.log("No security groups found.");
        }
      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidGroupId.Malformed") {
          console.warn(`${caught.message}. Please provide a valid GroupId.`);
        } else if (
          caught instanceof Error &&
          caught.name === "InvalidGroup.NotFound"
        ) {
          console.warn(caught.message);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    SecurityGroups 作成(create)
  BODY: |
    ■セキュリティ グループ作成

    import { CreateSecurityGroupCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * @param {{ 
        groupName: string,              // 最大255文字、sg-で始まる名前は指定不可
        description: string             // 最大255文字
      }} options
    */
    export const main = async ({ groupName, description }) => {
      const client = new EC2Client({});
      const command = new CreateSecurityGroupCommand({
        GroupName: groupName,
        Description: description,
      });

      try {
        const { GroupId } = await client.send(command);
        console.log(GroupId);           // セキュリティグループID
      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidParameterValue") {
          console.warn(`${caught.message}.`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    SecurityGroups イングレス追加(addIngress)
  BODY: |
    ■ 指定された受信 (イングレス) ルールをセキュリティ グループに追加

    import { AuthorizeSecurityGroupIngressCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * AWSコンソール(or DescribeSecurityGroupsCommand)からのグループID
    * 承認する IP アドレス https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#CIDR_notation
    * @param {{ groupId: string, ipAddress: string }} options
    */
    export const main = async ({ groupId, ipAddress }) => {
      const client = new EC2Client({});
      const command = new AuthorizeSecurityGroupIngressCommand({
        GroupId: groupId,
        IpPermissions: [
          {
            IpProtocol: "tcp",
            FromPort: 22,
            ToPort: 22,
            IpRanges: [{ CidrIp: `${ipAddress}/32` }],
          },
        ],
      });

      try {
        const { SecurityGroupRules } = await client.send(command);
        console.log(JSON.stringify(SecurityGroupRules, null, 2));   // ルールの詳細

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidGroupId.Malformed") {
          console.warn(`${caught.message}. Please provide a valid GroupId.`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    SecurityGroups 削除(delete)
  BODY: |
    ■セキュリティ グループ削除

    import { DeleteSecurityGroupCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * @param {{ groupId: string }} options
    */
    export const main = async ({ groupId }) => {
      const client = new EC2Client({});
      const command = new DeleteSecurityGroupCommand({
        GroupId: groupId,
      });

      try {
        await client.send(command);
        console.log("削除完了");
      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidGroupId.Malformed") {
          console.warn(`${caught.message}. Please provide a valid GroupId.`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance 取得(describe)
  BODY: |
    ■ 過去1か月以内に開始された提供されたアーキテクチャで実行される全EC2インスタンス一覧

    import { EC2Client, paginateDescribeInstances } from "@aws-sdk/client-ec2";

    /**
    * @param {{ pageSize: string, architectures: string[] }} options
    */
    export const main = async ({ pageSize, architectures }) => {
      pageSize = Number.parseInt(pageSize);
      const client = new EC2Client({});
      const d = new Date();
      const year = d.getFullYear();
      const month = `0${d.getMonth() + 1}`.slice(-2);
      const launchTimePattern = `${year}-${month}-*`;

      const paginator = paginateDescribeInstances(
        {
          client,
          pageSize,
        },
        {
          Filters: [
            { Name: "architecture",        Values: architectures },
            { Name: "instance-state-name", Values: ["running"] },
            { Name: "launch-time",         Values: [launchTimePattern] },
          ],
        },
      );

      try {
        /* @type {import('@aws-sdk/client-ec2').Instance[]} */
        const instanceList = [];
        for await (const page of paginator) {
          const { Reservations } = page;
          for (const reservation of Reservations) {
            instanceList.push(...reservation.Instances);
          }
        }
        console.log(`${instanceList.map((instance) => instance.InstanceId).join("\n")}`);

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidParameterValue") {
          console.warn(`${caught.message}.`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance タイプ(InstanceTypes)
  BODY: |
    ■ 指定インスタンスタイプ

    import { EC2Client, paginateDescribeInstanceTypes } from "@aws-sdk/client-ec2";

    /**
    * デフォルトで現リージョンの全タイプ表示。結果フィルタリングも可能
    * @param {{ pageSize: string, supportedArch: string[], freeTier: boolean }} options
    */
    export const main = async ({ pageSize, supportedArch, freeTier }) => {
      pageSize = Number.parseInt(pageSize);
      const client = new EC2Client({});

      // ページネーション関数は、基礎コマンドをラップするラッパー
      const paginator = paginateDescribeInstanceTypes(
        { client, pageSize },  // ページサイズ制限しないと長い時間。pageSizeはMaxResultsのラッパー
        {
          Filters: [
            { Name: "processor-info.supported-architecture", Values: supportedArch },
            { Name: "free-tier-eligible", Values: [freeTier ? "true" : "false"] },
          ],
        },
      );

      try {
        /* @type {import('@aws-sdk/client-ec2').InstanceTypeInfo[]} */
        const instanceTypes = [];
        for await (const page of paginator) {
          if (page.InstanceTypes.length) {
            instanceTypes.push(...page.InstanceTypes);
            if (instanceTypes.length >= 1) { break; } // 1件以上取得したら終了
          }
        }
        console.log(
          `${instanceTypes.map((it) => `${it.InstanceType}: ${it.MemoryInfo.SizeInMiB} MiB`).join("\n")}`,
        );

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidParameterValue") {
          console.warn(`${caught.message}`);
          return [];
        }
        throw caught;
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance 監視(monitor)
  BODY: |
    ■ 選択インスタンスの詳細な監視を有効化

    import { EC2Client, MonitorInstancesCommand } from "@aws-sdk/client-ec2";

    /**
    * 選択インスタンスの詳細な監視を有効化
    * デフォルトでは、メトリクスは 5 分ごとに Amazon CloudWatch に送信
    * 有料で 1 分ごとに変更可能
    * @param {{ instanceIds: string[] }} options
    */
    export const main = async ({ instanceIds }) => {
      const client = new EC2Client({});
      const command = new MonitorInstancesCommand({
        InstanceIds: instanceIds,
      });

      try {
        const { InstanceMonitorings } = await client.send(command);
        const instancesBeingMonitored = InstanceMonitorings.map(
          (im) => `${im.InstanceId} : ${im.Monitoring.State}.`,
        );
        console.log(instancesBeingMonitored.join("\n"));

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidParameterValue") {
          console.warn(`${caught.message}`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance 監視停止(unmonitor)
  BODY: |

- ENTRY:
  EXPLAIN: |
    Instance 開始(start)
  BODY: |
    ■ 停止した Amazon EBS ベースのインスタンス起動

    import { EC2Client, StartInstancesCommand } from "@aws-sdk/client-ec2";
    import { fileURLToPath } from "node:url";
    import { parseArgs } from "node:util";

    /**
    * @param {{ instanceIds }} options
    */
    export const main = async ({ instanceIds }) => {
      const client = new EC2Client({});
      const command = new StartInstancesCommand({
        InstanceIds: instanceIds,
      });

      try {
        const { StartingInstances } = await client.send(command);
        const instanceIdList = StartingInstances.map(
          (instance) => ` • ${instance.InstanceId}`,
        );
        console.log(instanceIdList.join("\n"));

      } catch (caught) {
        if (
          caught instanceof Error && caught.name === "InvalidInstanceID.NotFound"
        ) {
          console.warn(`${caught.message}`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance 生成(run)
  BODY: |
    ■ 新しい EC2 インスタンス生成

    import { EC2Client, RunInstancesCommand } from "@aws-sdk/client-ec2";

    /**
    * @param {{
    *  keyName: string,                   // Your key pair name.
    *  securityGroupIds: string[],        // Your security group.
    *  imageId: string,                   // An Amazon Machine Image (AMI)
    *  instanceType: import('@aws-sdk/client-ec2')._InstanceType,
    *  minCount?: number,                 // 指定下限値(AZの制限あり)
    *  maxCount?: number }} options       // 指定上限値
    */
    export const main = async ({
      keyName,
      securityGroupIds,
      imageId,
      instanceType,
      minCount = "1",
      maxCount = "1",
    }) => {
      const client = new EC2Client({});
      minCount = Number.parseInt(minCount);
      maxCount = Number.parseInt(maxCount);
      const command = new RunInstancesCommand({
        KeyName: keyName,
        SecurityGroupIds: securityGroupIds,
        ImageId: imageId,
        InstanceType: instanceType,
        MinCount: minCount,
        MaxCount: maxCount,
      });

      try {
        const { Instances } = await client.send(command);
        const instanceList = Instances.map((instance) => `• ${instance.InstanceId}`).join("\n");
        console.log(`${instanceList}`);

      } catch (caught) {
        if (caught instanceof Error && caught.name === "ResourceCountExceeded") {
          console.warn(`${caught.message}`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance 停止(stop)
  BODY: |
    ■ 1つ以上の EC2 インスタンスを停止

    import { EC2Client, StopInstancesCommand } from "@aws-sdk/client-ec2";
    import { fileURLToPath } from "node:url";
    import { parseArgs } from "node:util";

    /* @param {{ instanceIds: string[] }} options */
    export const main = async ({ instanceIds }) => {
      const client = new EC2Client({});
      const command = new StopInstancesCommand({
        InstanceIds: instanceIds,
      });

      try {
        const { StoppingInstances } = await client.send(command);
        const instanceIdList = StoppingInstances.map(
          (instance) => ` • ${instance.InstanceId}`
        );
        console.log(instanceIdList.join("\n"));

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidInstanceID.NotFound") {
          console.warn(`${caught.message}`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance 終了(terminate)
  BODY: |
    ■ 1 つ以上の EC2 インスタンスを終了

    import { EC2Client, TerminateInstancesCommand } from "@aws-sdk/client-ec2";
    import { fileURLToPath } from "node:url";
    import { parseArgs } from "node:util";

    /* @param {{ instanceIds: string[] }} options */
    export const main = async ({ instanceIds }) => {
      const client = new EC2Client({});
      const command = new TerminateInstancesCommand({
        InstanceIds: instanceIds,
      });

      try {
        const { TerminatingInstances } = await client.send(command);
        const instanceList = TerminatingInstances.map(
          (instance) => ` • ${instance.InstanceId}`,
        );
        console.log(instanceList.join("\n"));

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidInstanceID.NotFound") {
          console.warn(`${caught.message}`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Instance 再起動(reboot)
  BODY: |
    ■ 指定インスタンス再起動求(非同期)

    import { EC2Client, RebootInstancesCommand } from "@aws-sdk/client-ec2";

    /* @param {{ instanceIds: string[] }} options */
    export const main = async ({ instanceIds }) => {
      const client = new EC2Client({});
      const command = new RebootInstancesCommand({
        InstanceIds: instanceIds,
      });

      try {
        await client.send(command);
        console.log("Instance rebooted successfully.");

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidInstanceID.NotFound") {
          console.warn(`${caught.message}. Please provide the InstanceId`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Address 割り当て(allocate)
  BODY: |
    ■ AWS アカウントに Elastic IP アドレスを割り当て

    import { AllocateAddressCommand, EC2Client } from "@aws-sdk/client-ec2";

    export const main = async () => {
      const client = new EC2Client({});
      const command = new AllocateAddressCommand({});

      try {
        const { AllocationId, PublicIp } = await client.send(command);
        console.log("新しいIPアドレス割り当て完了");
        console.log(`ID: ${AllocationId} Public IP: ${PublicIp}`);
        // Amazon EC2のAWSマネジメントコンソールでIPアドレス確認
        // 「ネットワークとセキュリティ」>「Elastic IP」
      } catch (caught) {
        if (caught instanceof Error && caught.name === "MissingParameter") {
          console.warn(`${caught.message}. Did you provide these values?`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Address 関連付け(associate)
  BODY: |
    ■ instance または network interface で Elastic IP アドレス/キャリア IP アドレスを関連付け
      (Wavelength Zone のサブネットにあるインスタンスの場合)

    import { AssociateAddressCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * @param {{ 
          instanceId: string,           // 先にEC2インスタンス作成(RunInstancesCommand)
          allocationId: string          // 先に割り当て(AllocateAddressCommand)
      }} options
    */
    export const main = async ({ instanceId, allocationId }) => {
      const client = new EC2Client({});
      const command = new AssociateAddressCommand({
        AllocationId: allocationId,
        InstanceId: instanceId,
      });

      try {
        const { AssociationId } = await client.send(command);
        console.log(`${allocationId}, ${instanceId}, ${AssociationId}`);

      } catch (caught) {
        if (
          caught instanceof Error &&
          caught.name === "InvalidAllocationID.NotFound"
        ) {
          console.warn(
            `${caught.message}. Did you provide the ID of a valid Elastic IP address AllocationId?`,
          );
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Address 関連解除(disassociate)
  BODY: |
    ■ Elastic IP アドレスとインスタンスの関連付けを解除
    import { DisassociateAddressCommand, EC2Client } from "@aws-sdk/client-ec2";

    /* @param {{ associationId: string }} options */
    export const main = async ({ associationId }) => {
      const client = new EC2Client({});
      const command = new DisassociateAddressCommand({
        AssociationId: associationId,   // PublicIp は廃止予定
      });

      try {
        await client.send(command);
        console.log("Successfully disassociated address");
      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidAssociationID.NotFound") {
          console.warn(`${caught.message}.`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Address 解放(release)
  BODY: |
    ■ Elastic IP アドレスを解放

    import { ReleaseAddressCommand, EC2Client } from "@aws-sdk/client-ec2";

    /* @param {{ allocationId: string }} options */
    export const main = async ({ allocationId }) => {
      const client = new EC2Client({});
      const command = new ReleaseAddressCommand({
        AllocationId: allocationId,
      });

      try {
        await client.send(command);
        console.log("Successfully released address.");
      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidAllocationID.NotFound") {
          console.warn(`${caught.message}. Please provide a valid AllocationID.`);
        } else {
          throw caught;
        }
      }
    };

- ENTRY:
  EXPLAIN: |
    Address 取得(describe)
  BODY: |
    ■ Elastic IP アドレスの情報を取得

    import { DescribeAddressesCommand, EC2Client } from "@aws-sdk/client-ec2";

    /**
    * 指定 Elastic IP アドレス or すべての Elastic IP アドレス
    * @param {{ allocationId: string }} options
    */
    export const main = async ({ allocationId }) => {
      const client = new EC2Client({});
      const command = new DescribeAddressesCommand({
        AllocationIds: [allocationId],     // 省略すると全ての Elastic IP アドレスを取得
      });

      try {
        const { Addresses } = await client.send(command);
        const addressList = Addresses.map((address) => ` • ${address.PublicIp}`);
        console.log(addressList.join("\n"));

      } catch (caught) {
        if (caught instanceof Error && caught.name === "InvalidAllocationID.NotFound") {
          console.warn(`${caught.message}. Please provide a valid AllocationId.`);
        } else {
          throw caught;
        }
      }
    };
