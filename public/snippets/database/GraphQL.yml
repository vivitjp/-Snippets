---
#-------------------------------
# GraphQL
#-------------------------------
- KEY: gql.top.category
  CATEGORY: Kick Start

- KEY: gql.kick.start.schema
  EXPLAIN: ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
  BODY: |
    â–  ã‚¹ã‚­ãƒ¼ãƒå®šç¾© (Schema Definition)

    # Userå‹
    type User {
      id: ID!
      username: String!
      email: String
      posts: [Post!]!                   # ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŠ•ç¨¿ã—ãŸè¨˜äº‹ã®ãƒªã‚¹ãƒˆ
    }

    # Postå‹
    type Post {
      id: ID!
      title: String!
      content: String!
      author: User! # ã“ã®è¨˜äº‹ã‚’æ›¸ã„ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼
    }

    # ã‚¯ã‚¨ãƒªå®šç¾©
    type Query {
      user(id: ID!): User               # IDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒª
      allUsers: [User!]!                # å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒª
    }

    # ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©
    type Mutation {
      createPost(title: String!, content: String!, authorId: ID!): Post!
    }

- KEY: gql.kick.start.query
  EXPLAIN: ã‚¯ã‚¨ãƒª
  BODY: |
    â–  ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒª
    query GetAllUserNames {
      allUsers {
        id
        username
        # emailãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ä¸è¦ãªã®ã§å–å¾—ã—ãªã„
      }
    }

    ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    {
      "data": {
        "allUsers": [
          {
            "id": "1",
            "username": "alice"
          },
          {
            "id": "2",
            "username": "bob"
          }
        ]
      }
    }

    â–  ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒª(å¼•æ•°ä»˜ã)
    query GetUserWithPosts($userId: ID!) {
      user(id: $userId) {
        username
        email
        posts {
          title
        }
      }
    }

    â—ã‚¯ã‚¨ãƒªå¤‰æ•°
    {
      "userId": "1"
    }

    â—ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    {
      "data": {
        "user": {
          "username": "alice",
          "email": "alice@example.com",
          "posts": [
            {
              "title": "GraphQLå…¥é–€"
            },
            {
              "title": "Pythonã®æ–°ã—ã„æ©Ÿèƒ½"
            }
          ]
        }
      }

- KEY: gql.kick.start.mutation
  EXPLAIN: ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  BODY: |
    â–  ã‚µãƒ³ãƒ—ãƒ«ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    mutation CreateNewPost($title: String!, $content: String!, $authorId: ID!) {
      createPost(title: $title, content: $content, authorId: $authorId) {
        # ä½œæˆæˆåŠŸå¾Œã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã—ã¦ã»ã—ã„æƒ…å ±ã‚’æŒ‡å®š
        id
        title
        author {
          username
        }
      }
    }

    â—ã‚¯ã‚¨ãƒªå¤‰æ•°
    {
      "title": "VSCodeã®è¨­å®š",
      "content": "ä¾¿åˆ©ãªVSCodeã®è¨­å®šã‚’ç´¹ä»‹ã—ã¾ã™ã€‚",
      "authorId": "2"
    }

    â—ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    {
      "data": {
        "createPost": {
          "id": "3",
          "title": "VSCodeã®è¨­å®š",
          "author": {
            "username": "bob"
          }
        }
      }
    }

- KEY: gql.ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
  EXPLAIN: |
    ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
  TABLE:
    OPTION:
      ALIGN:
        - left
        - left
      HAS_TITLE: false
      WIDTH:
        - 15%
    BODY: |
      ã‚¹ã‚­ãƒ¼ãƒ (Schema)	APIã‚’é€šã˜ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã®å½¢ã‚„ã€å¯èƒ½ãªæ“ä½œï¼ˆã‚¯ã‚¨ãƒªãƒ»ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã®å…¨ä½“åƒã‚’å®šç¾©ã™ã‚‹ã‚‚ã®ã€‚
      ã‚¯ã‚¨ãƒª (Query)	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹æ“ä½œã€‚ã©ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…è¦ã‹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæŒ‡å®šã§ãã‚‹ã€‚
      ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (Mutation)	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚µãƒ¼ãƒãƒ¼ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ï¼ˆä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ï¼‰ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹æ“ä½œã€‚
      ãƒªã‚¾ãƒ«ãƒ (Resolver)	ã‚¹ã‚­ãƒ¼ãƒã§å®šç¾©ã•ã‚ŒãŸç‰¹å®šã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚„æ“ä½œï¼ˆã‚¯ã‚¨ãƒªãƒ»ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ãŒè¦æ±‚ã•ã‚ŒãŸéš›ã«ã€å®Ÿéš›ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã‹ã‚‰å–å¾—ãƒ»å‡¦ç†ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆé–¢æ•°ï¼‰ã€‚
      ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (Field)	ã‚¹ã‚­ãƒ¼ãƒå†…ã®å‹ãŒæŒã¤å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿å±æ€§ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã‚¯ã‚¨ãƒªã§å–å¾—ã—ãŸã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é¸æŠã™ã‚‹ã€‚
      ã‚¹ã‚«ãƒ©ãƒ¼å‹ (Scalar Types)	ãã‚Œä»¥ä¸Šåˆ†è§£ã§ããªã„ã€åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿å‹ï¼ˆä¾‹: String, Int, Boolean, Float, IDï¼‰ã€‚
      éãƒŒãƒ« (Non-Null / !)	ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å®šç¾©ã§å‹ã®æœ«å°¾ã« ! ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€ãã®å€¤ãŒ null ã«ãªã‚‰ãªã„ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹åˆ¶ç´„ã€‚
      ãƒªã‚¹ãƒˆ (List / [])	ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå˜ä¸€ã®å€¤ã§ã¯ãªãã€ãã®å‹ã®å€¤ã®é…åˆ—ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ï¼ˆä¾‹: [Post], [String!]!ï¼‰ã€‚
      ã‚¯ã‚¨ãƒªå¤‰æ•° (Variables)	ã‚¯ã‚¨ãƒªã‚„ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œæ™‚ã«ã€å‹•çš„ãªå€¤ã‚’å¤–éƒ¨ã‹ã‚‰å®‰å…¨ã«æ³¨å…¥ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ï¼ˆä¾‹: æ¤œç´¢IDã‚„å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ï¼‰ã€‚
      ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆ (Fragment)	è¤‡æ•°ã®ã‚¯ã‚¨ãƒªã‚„å ´æ‰€ã§å…±é€šã—ã¦ä½¿ç”¨ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é›†åˆã‚’å®šç¾©ã—ã€å†åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹æ©Ÿèƒ½ã€‚
      ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ– (Directives)	ã‚¯ã‚¨ãƒªã‚„ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã«ä»˜åŠ çš„ãªæŒ‡ç¤ºã‚„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¸ãˆã‚‹ãŸã‚ã®æ§‹æ–‡ï¼ˆä¾‹: @include(if: ...) ã‚„ @deprecatedï¼‰ã€‚
      ã‚¤ãƒ³ãƒˆãƒ­ã‚¹ãƒšã‚¯ã‚·ãƒ§ãƒ³ (Introspection)	ã‚¹ã‚­ãƒ¼ãƒè‡ªä½“ã‚’ã‚¯ã‚¨ãƒªã™ã‚‹ï¼ˆå•ã„åˆã‚ã›ã‚‹ï¼‰æ©Ÿèƒ½ã€‚é–‹ç™ºãƒ„ãƒ¼ãƒ«ãŒAPIã®æ§‹é€ ã‚’å‹•çš„ã«è§£æã™ã‚‹ã®ã«åˆ©ç”¨ã™ã‚‹ã€‚
      ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ (Subscription)	ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ãŸã‚ã®æ“ä½œï¼ˆé€šå¸¸WebSocketã‚’ä½¿ç”¨ï¼‰ã€‚
      ãƒ«ãƒ¼ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (Root Field / Root Operation)	ã‚¹ã‚­ãƒ¼ãƒã®é–‹å§‹ç‚¹ã¨ãªã‚‹ç‰¹åˆ¥ãªå‹ï¼ˆé€šå¸¸ã¯ Query, Mutation, Subscription ã®3ã¤ï¼‰ã€‚
      ã‚¿ã‚¤ãƒ—ãƒ‡ãƒ• (TypeDefs)	ã‚¹ã‚­ãƒ¼ãƒå®šç¾©è¨€èª (SDL) ã‚’ä½¿ã£ã¦è¨˜è¿°ã•ã‚ŒãŸã€å…·ä½“çš„ãªå‹å®šç¾©ã®æ–‡å­—åˆ—ã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã€‚

#-------------------------------
# Apollo Server
#-------------------------------
- KEY: gql.server.category
  CATEGORY: ã‚µãƒ¼ãƒ

- KEY: gql.server.top
  EXPLAIN: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
  BODY: |
    â–  å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (Node.js + Express + Apollo Server)
    npm install express @apollo/server graphql
    npm install -D typescript @types/node ts-node @apollo/server @types/express

- KEY: gql.server.top
  EXPLAIN: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆä¾‹
  BODY: |
    â–  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆä¾‹
    graphql-server-example/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ index.ts        # ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã¨Expressã®è¨­å®š
    â”‚   â”œâ”€â”€ schema.ts       # GraphQLã‚¹ã‚­ãƒ¼ãƒå®šç¾© (typeDefs)
    â”‚   â”œâ”€â”€ resolvers.ts    # ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ (resolvers) <--- ã“ã“ã‚’ä¿®æ­£
    â”‚   â””â”€â”€ apiService.ts   # å¤–éƒ¨APIå‘¼ã³å‡ºã—ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    â”œâ”€â”€ package.json
    â”œâ”€â”€ tsconfig.json

- KEY: gql.server.å¤–éƒ¨APIå‘¼ã³å‡ºã—
  EXPLAIN: src/apiService.ts (å¤–éƒ¨APIå‘¼ã³å‡ºã—)
  BODY: |
    import axios, { AxiosError } from 'axios';

    â–  å‹å®šç¾©
    export interface ExternalPost {
        userId: number;
        id: number;
        title: string;
        body: string;
    }

    export interface CreatePostArgs {
        title: string;
        body: string;
        userId: number;
    }

    const API_URL = 'https://jsonplaceholder.typicode.com';

    â–  fetch all
    export const fetchPosts = async (): Promise<ExternalPost[]> => {
        try {
            const response = await axios.get<ExternalPost[]>(`${API_URL}/posts`);
            return response.data;
        } catch (error) {
            if (axios.isAxiosError(error)) {
                console.error(`API Error: ${error.message}`);
                throw new Error(`å¤–éƒ¨APIã®å‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            } else {
                console.error(`Unexpected Error: ${error}`);
                throw new Error('ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
    };

    â–  fetch by ID
    export const fetchPostById = async (id: number): Promise<ExternalPost> => {
        try {
            const response = await axios.get<ExternalPost>(`${API_URL}/posts/${id}`);
            return response.data;
        } catch (error) {
            if (axios.isAxiosError(error) && error.response?.status === 404) {
                throw new Error(`æŠ•ç¨¿ID ${id} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`);
            } else if (axios.isAxiosError(error)) {
                throw new Error(`API Error: ${error.message}`);
            } else {
                throw new Error('ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
    };

    â–  create
    export const createPost = async (postData: CreatePostArgs): Promise<ExternalPost> => {
        try {
            const response = await axios.post<ExternalPost>(`${API_URL}/posts`, postData);
            return response.data;
        } catch (error) {
            if (axios.isAxiosError(error)) {
                console.error(`API Error during creation: ${error.message}`);
                throw new Error(`æŠ•ç¨¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            } else {
                throw new Error('ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
    };

    â–  delete
    export const deletePost = async (id: number): Promise<{ success: boolean; id: number }> => {
        try {
            await axios.delete(`${API_URL}/posts/${id}`);
            return { success: true, id: id };
        } catch (error) {
            if (axios.isAxiosError(error) && error.response?.status === 404) {
                throw new Error(`å‰Šé™¤å¯¾è±¡ã®æŠ•ç¨¿ID ${id} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`);
            } else if (axios.isAxiosError(error)) {
                console.error(`API Error during deletion: ${error.message}`);
                throw new Error(`æŠ•ç¨¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            } else {
                throw new Error('ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            }
        }
    };

- KEY: gql.server.schema
  EXPLAIN: src/schema.ts (ã‚¹ã‚­ãƒ¼ãƒå®šç¾©)
  BODY: |
    export const typeDefs = `#graphql
      type Post {
        id: ID!
        title: String!
        body: String!
        userId: Int!
      }

      type Query {
        posts: [Post]
        post(id: ID!): Post
      }

      # å‰Šé™¤ã®æˆå¦ã‚’è¿”ã™ãŸã‚ã®å‹ã‚’æ–°ã—ãå®šç¾©
      type DeleteResult {
        success: Boolean!
        id: ID!
      }

      type Mutation {
        createPost(title: String!, body: String!, userId: Int!): Post!
        deletePost(id: ID!): DeleteResult!
      }
    `;

- KEY: gql.server.resolvers
  EXPLAIN: src/resolvers.ts (ãƒªã‚¾ãƒ«ãƒ)
  BODY: |
    import { fetchPosts, fetchPostById, createPost, deletePost } from './apiService';
    import { GraphQLError } from 'graphql';

    export const resolvers = {
      Query: {
        â–  å…¨å–å¾—
        posts: async () => {
          try {
            const data = await fetchPosts();
            return data;
          } catch (error: any) {
            throw new Error(`æŠ•ç¨¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
          }
        },

        â–  IDæŒ‡å®šå–å¾—
        post: async (parent: any, args: { id: string }) => {
          try {
            const data = await fetchPostById(Number(args.id));
            return data;
          } catch (error: any) {
            throw new Error(`æŠ•ç¨¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
          }
        },
      },

      Mutation: {
        â–  ä½œæˆ
        createPost: async (parent: any, args: { title: string, body: string, userId: number }) => {
          try {
            const newPost = await createPost(args);
            return newPost;
          } catch (error: any) {
            throw new GraphQLError(`Mutation failed: ${error.message}`, {
                extensions: { code: 'API_CREATION_ERROR' },
            });
          }
        },
        
        â–  å‰Šé™¤
        deletePost: async (parent: any, args: { id: string }) => {
            try {
                // APIã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã—ã€å‰Šé™¤çµæœã‚’è¿”ã™
                const result = await deletePost(Number(args.id));
                return result;
            } catch (error: any) {
                throw new GraphQLError(`Deletion failed: ${error.message}`, {
                    extensions: { code: 'API_DELETION_ERROR' },
                });
            }
        }
      },
    };

- KEY: gql.server.index
  EXPLAIN: src/index.ts (ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å‡¦ç†)
  BODY: |
    import { ApolloServer } from '@apollo/server';
    import { expressMiddleware } from '@apollo/server/express4';
    import { ApolloServerPluginDrainHttpServer } from '@apollo/server/plugin/drainHttpServer';
    import express from 'express';
    import http from 'http';
    import cors from 'cors';
    import bodyParser from 'body-parser';

    import { typeDefs } from './schema';
    import { resolvers } from './resolvers';

    interface MyContext {
      token?: String;
    }

    const app = express();
    const httpServer = http.createServer(app);

    const server = new ApolloServer<MyContext>({
      typeDefs,
      resolvers,
      plugins: [ApolloServerPluginDrainHttpServer({ httpServer })],
    });

    async function startServer() {
        await server.start();

        app.use(
            '/graphql',
            cors< cors.CorsRequest >(),
            bodyParser.json(),
            expressMiddleware(server, {
                context: async ({ req }) => ({ token: req.headers.token }),
            }),
        );

        await new Promise<void>((resolve) => httpServer.listen({ port: 4000 }, resolve));
        console.log(`ğŸš€ Server ready at http://localhost:4000/graphql`);
    }

    startServer();

#-------------------------------
# Apollo Client
#-------------------------------
- KEY: gql.client.category
  CATEGORY: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

- KEY: gql.client.top
  EXPLAIN: ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
  BODY: |
    npm install @apollo/client graphql
    npm install -D typescript ts-node @types/node # ts-nodeã¯å®Ÿè¡Œç”¨

- KEY: gql.client.client
  EXPLAIN: client.ts (Apollo Clientè¨­å®š)
  BODY: |
    import { ApolloClient, InMemoryCache, gql, ApolloQueryResult } from '@apollo/client';

    const client = new ApolloClient({
      uri: 'http://localhost:4000/graphql', // <-- GraphQLã‚µãƒ¼ãƒãƒ¼URL
      cache: new InMemoryCache(),
    });

    // --- 1. ã‚¯ã‚¨ãƒªå®šç¾© ---
    const GET_POSTS = gql`
      query GetPosts {
        posts {
          id
          title
          userId
        }
      }
    `;

    // --- 2. ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© ---
    const CREATE_POST = gql`
      mutation CreateNewPost($title: String!, $body: String!, $userId: Int!) {
        createPost(title: $title, body: $body, userId: $userId) {
          id
          title
          userId
        }
      }
    `;

    // --- 3. ãƒ‡ãƒ¼ã‚¿å–å¾— ---
    async function fetchPosts() {
      console.log("--- æŠ•ç¨¿ãƒªã‚¹ãƒˆã‚’å–å¾—ä¸­ ---");
      try {
        const result: ApolloQueryResult<any> = await client.query({
          query: GET_POSTS
        });
        console.log("å–å¾—çµæœ:", result.data.posts);
      } catch (error) {
        console.error("æŠ•ç¨¿ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
      }
    }

    // --- 4. ãƒ‡ãƒ¼ã‚¿ç™»éŒ² ---
    async function createNewPost(title: string, body: string, userId: number) {
      console.log(`--- æ–°ã—ã„æŠ•ç¨¿ã‚’ä½œæˆä¸­: ${title} ---`);
      try {
        const result = await client.mutate({
          mutation: CREATE_POST,
          variables: { // ã‚¯ã‚¨ãƒªå¤‰æ•°ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™
            title,
            body,
            userId
          },
        });
        console.log("ä½œæˆã•ã‚ŒãŸæŠ•ç¨¿:", result.data.createPost);
      } catch (error) {
        console.error("æŠ•ç¨¿ã®ä½œæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
      }
    }

    async function main() {
      await fetchPosts();

      await createNewPost("ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æŠ•ç¨¿", "Apollo Clientã‚’ä½¿ã£ã¦æŠ•ç¨¿ã—ã¾ã—ãŸã€‚", 1);
      
      // æ–°ã—ã„æŠ•ç¨¿ã‚’å«ã‚ã¦å†åº¦ãƒªã‚¹ãƒˆã‚’å–å¾—
      await fetchPosts();
    }

    main();

- KEY: gql.client.useMutation
  EXPLAIN: useMutationã®ä½¿ç”¨ä¾‹(App.tsx)
  BODY: |
    â–  App.tsx ã‚„ index.tsx 
    import { ApolloClient, InMemoryCache, ApolloProvider } from '@apollo/client';
    import React from 'react';
    import ReactDOM from 'react-dom/client';
    import CreatePostForm from './CreatePostForm'; 

    const client = new ApolloClient({
      uri: 'http://localhost:4000/graphql', 
      cache: new InMemoryCache(),
    });

    const App = () => (
      <ApolloProvider client={client}>
        <h1>GraphQL Mutations Example</h1>
        <CreatePostForm />
      </ApolloProvider>
    );

    ReactDOM.createRoot(document.getElementById('root')!).render(<App />);

- KEY: gql.client.useMutation.form
  EXPLAIN: Formä½¿ç”¨ä¾‹
  BODY: |
    â–  CreatePostForm.tsx
    import React, { useState } from 'react';
    import { useMutation, gql } from '@apollo/client';

    // ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© (GraphQLã‚¹ã‚­ãƒ¼ãƒã«ä¾å­˜)
    const CREATE_POST = gql`
      mutation CreateNewPost($title: String!, $body: String!, $userId: Int!) {
        createPost(title: $title, body: $body, userId: $userId) {
          id
          title
          # ã“ã“ã§ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã£ã¦ãã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æŒ‡å®š
        }
      }
    `;

    const CreatePostForm: React.FC = () => {
      const [title, setTitle] = useState('');
      const [body, setBody] = useState('');
      const [userId, setUserId] = useState(1); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ID 1 ã‚’ä½¿ç”¨

      // useMutation ãƒ•ãƒƒã‚¯ã®ä½¿ç”¨
      // [ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°, çµæœã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ] ã®é…åˆ—ã‚’è¿”ã™
      const [createPost, { loading, error, data }] = useMutation(
        CREATE_POST,
        // ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸå¾Œã€GET_POSTS ã‚¯ã‚¨ãƒªã‚’è‡ªå‹•çš„ã«å†å®Ÿè¡Œã™ã‚‹
        refetchQueries: [
          { query: GET_POSTS } // ã‚¯ã‚¨ãƒªã®åå‰ã¾ãŸã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æŒ‡å®š
        ],
      );

      const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();

        try {
          // ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ã‚’å®Ÿè¡Œã—ã€variablesï¼ˆå¤‰æ•°ï¼‰ã‚’æ¸¡ã™
          const response = await createPost({
            variables: {
              title,
              body,
              userId,
            },
          });

          console.log("æŠ•ç¨¿ãŒæˆåŠŸã—ã¾ã—ãŸ:", response.data.createPost);
          setTitle('');
          setBody('');

        } catch (err) {
          // ã‚¨ãƒ©ãƒ¼ã¯ useMutation ã® error ã‚¹ãƒ†ãƒ¼ãƒˆã§ã‚‚æ•æ‰ã•ã‚Œã‚‹
          console.error("ãƒŸãƒ¥ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", err);
        }
      };

      return (
        <form onSubmit={handleSubmit}>
          <h2>æ–°ã—ã„æŠ•ç¨¿ã‚’ä½œæˆ</h2>

          {/* ãƒ­ãƒ¼ãƒ‰ä¸­ã€ã‚¨ãƒ©ãƒ¼ã€æˆåŠŸæ™‚ã®è¡¨ç¤º */}
          {loading && <p>é€ä¿¡ä¸­ã§ã™...</p>}
          {error && <p style={{ color: 'red' }}>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {error.message}</p>}
          {data && <p style={{ color: 'green' }}>æŠ•ç¨¿ID {data.createPost.id} ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸï¼</p>}

          <div>
            <label>ã‚¿ã‚¤ãƒˆãƒ«:</label>
            <input type="text" value={title} onChange={(e) => setTitle(e.target.value)} required />
          </div>
          <div>
            <label>æœ¬æ–‡:</label>
            <textarea value={body} onChange={(e) => setBody(e.target.value)} required />
          </div>
          
          <button type="submit" disabled={loading}>
            æŠ•ç¨¿ã™ã‚‹
          </button>
        </form>
      );
    };

    export default CreatePostForm;

- KEY: gql.client.useMutation.ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  EXPLAIN: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³
  BODY: |
    const CREATE_POST = gql`...`;
    const GET_POSTS = gql`...`;

    const CreatePostForm = () => {
      const [createPost] = useMutation(CREATE_POST, {
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç›´æ¥æ“ä½œã™ã‚‹
        update(cache, { data }) {
          const newPost = data?.createPost;

          // GET_POSTS ã‚¯ã‚¨ãƒªã®çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰èª­ã¿å–ã‚‹
          const existingPosts: any = cache.readQuery({ query: GET_POSTS });

          // æ–°ã—ã„æŠ•ç¨¿ã‚’æ—¢å­˜ã®ãƒªã‚¹ãƒˆã®å…ˆé ­ã«è¿½åŠ ã—ã¦ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æ›¸ãæˆ»ã™
          if (existingPosts && newPost) {
            cache.writeQuery({
              query: GET_POSTS,
              data: {
                posts: [newPost, ...existingPosts.posts],
              },
            });
          }
        }
      });

      // ... handleSubmit ãƒ­ã‚¸ãƒƒã‚¯ ...
    };

- KEY: gql.client.useQuery
  EXPLAIN: useQueryã®ä½¿ç”¨ä¾‹
  BODY: |
    import React from 'react';
    import { useQuery, gql } from '@apollo/client';

    // ----------------------------------------------------
    // 1. ã‚¯ã‚¨ãƒªå®šç¾© (GraphQLã‚¹ã‚­ãƒ¼ãƒã«ä¾å­˜)
    // ----------------------------------------------------
    const GET_POSTS = gql`
      query GetPosts {
        posts {
          id
          title
          userId
        }
      }
    `;

    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®å‹å®šç¾©
    interface Post {
      id: string;
      title: string;
      userId: number;
    }

    // ã‚¯ã‚¨ãƒªçµæœå…¨ä½“ã®å‹å®šç¾©
    interface QueryData {
      posts: Post[];
    }


    // ----------------------------------------------------
    // 2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã® useQuery ã®ä½¿ç”¨
    // ----------------------------------------------------
    const PostList: React.FC = () => {
      // è‡ªå‹•çš„ã«ã‚µãƒ¼ãƒãƒ¼ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé£›ã³ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæ›´æ–°ã•ã‚Œã‚‹
      const { loading, error, data, refetch } = useQuery<QueryData>(
        GET_POSTS
        // 5ç§’ (5000ãƒŸãƒªç§’) ã”ã¨ã«è‡ªå‹•ã§ã‚¯ã‚¨ãƒªã‚’å†å®Ÿè¡Œã™ã‚‹
        pollInterval: 5000, 
      
      );

      // --- çŠ¶æ…‹ã«å¿œã˜ãŸæç”» ---

      if (loading) {
        // ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã®è¡¨ç¤º
        return <p>æŠ•ç¨¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>;
      }

      if (error) {
        // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®è¡¨ç¤º
        return <p style={{ color: 'red' }}>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {error.message}</p>;
      }

      // æ›´æ–°ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã®ãƒãƒ³ãƒ‰ãƒ©
      const handleRefreshClick = () => {
        refetch(); // ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã™ã‚‹
      };
      
      // ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«å–å¾—ã§ããŸå ´åˆã®è¡¨ç¤º
      return (
        <div>
          <h2>æŠ•ç¨¿ãƒªã‚¹ãƒˆ</h2>
          <ul>
            {/* data.posts ãŒå­˜åœ¨ã—ã€ãƒªã‚¹ãƒˆã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãƒãƒƒãƒ—å‡¦ç† */}
            {data?.posts.map((post) => (
              <li key={post.id}>
                <strong>{post.title}</strong> (ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: {post.userId})
              </li>
            ))}
          </ul>
        <div>
          <button onClick={handleRefreshClick}>æœ€æ–°ã®æƒ…å ±ã«æ›´æ–°</button>
        </div>          
        </div>
      );
    };

    export default PostList;
