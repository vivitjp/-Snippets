---
#-------------------------------
# JavaScript: RegularExpression
#-------------------------------

- KEY: reg.RegExp
  EXPLAIN: æ­£è¦è¡¨ç¾
  BODY: |
    â–  æ­£è¦è¡¨ç¾å¤‰æ•°
    const re: RegExp = new RegExp(pattern[,flags])     // ã‚¯ãƒ©ã‚¹å®šç¾©
    const re: RegExp = new RegExp('AB', 'ig');         // ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    const re: RegExp = /AB/ig;                         // è¨˜è¿°

    â–  Deprecated
    [NG] re.compile(target);

    â–  æ­£è¦è¡¨ç¾.test(æ–‡å­—åˆ—): boolean
    const hits = /A/ig.test('ABA');                    // true

    â–  æ­£è¦è¡¨ç¾.exec(æ–‡å­—åˆ—): RegExpExecArray | null
    const hits = /A/ig.exec('ABA');                    // ["A"]  *gãƒ•ãƒ©ã‚°ã¨ã®ç›¸æ€§æ‚ªã—

    â–  æ–‡å­—åˆ—.match(æ­£è¦è¡¨ç¾): RegExpExecArray | null
    const hits = 'ABA'.match(/A/i);                    // ["A"]
    const hits = 'ABA'.match(/A/ig);                   // ["A", "A"]

    â–  æ–‡å­—åˆ—.matchAll(æ­£è¦è¡¨ç¾): IterableIterator<RegExpExecArray>å‹ *ES2021
    [NG] const hits = 'ABA'.matchAll(/A/i);            // gãƒ•ãƒ©ã‚°ãªã—Error
    const hits = 'ABA'.matchAll(/A/ig);                // {}
     => Array.from(hits)                               // [["A"], ["A"]] 

    â–  æ–‡å­—åˆ—.replace(æ­£è¦è¡¨ç¾): string
    const replaced = 'ABA'.replace(/A/i, "X");         // "XBA"
    const replaced = 'ABA'.replace(/A/ig, "X");        // "XBX"

    â–  æ–‡å­—åˆ—.replaceAll(æ­£è¦è¡¨ç¾): string *ES2021
    [NG] const replaced = 'ABA'.replaceAll(/A/i, "X"); // gãƒ•ãƒ©ã‚°ãªã—Error
    const replaced = 'ABA'.replaceAll(/A/ig, "X");     // "XBX"

- KEY: reg.captureGroup
  EXPLAIN: åå‰ä»˜ãã‚­ãƒ£ãƒ—ãƒãƒ£ã‚°ãƒ«ãƒ¼ãƒ— [ES2018]
  BODY: |
    const target = '123 456 789';
    const re = /(?<first>[0-9]+)\s(?<second>[0-9]+)/u;

    const hits1 = re.exec(target);                // ["123 456", "123", "456"]
    console.log(hits1?.groups?.first);            // '123'
    console.log(hits1?.groups?.second);           // '456'

    const hits2 = target.match(re);               // gãƒ•ãƒ©ã‚°ã¨ã®ç›¸æ€§æ‚ªã—
    console.log(hits2?.groups?.first);            // '123'
    console.log(hits2?.groups?.second);           // '456'

- KEY: reg.exec()
  EXPLAIN: ä¸€è‡´æ–‡å­—åˆ—å–å¾—
  BODY: |
    const target = '123 456 789';
    const re = /[0-9]+/g;

    â­• å®Ÿè¡Œã™ã‚‹åº¦ã«å†…éƒ¨indexãŒç§»å‹•
    let hit = re.exec(target);                    // ["123"]
    hit = re.exec(target);                        // ["456"] 
    hit = re.exec(target);                        // ["789"]
    hit = re.exec(target);                        // null

    while(hit = re.exec(target)){                 // ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚‚ã©ã
      hit;                                        // ["123"],["456"],["789"]
      re.lastIndex;                               // 3,7,11
    }

- KEY: reg.test()
  EXPLAIN: ä¸€è‡´Indexã®ç§»å‹•
  BODY: |
    const target = 'table cable maple';
    const re = new RegExp('ab*', 'g');

    â­• å®Ÿè¡Œã™ã‚‹åº¦ã«å†…éƒ¨indexãŒç§»å‹•
    re.lastIndex;                                 // 0
    re.test(target);                              // true
    re.lastIndex;                                 // 3
    re.test(target);                              // false

- KEY: reg.match()
  EXPLAIN: ä¸€è‡´:å€¤
  BODY: |
    const target = "123 456 789";
    const re = /[0-9]+/g;

    let hit = target.match(re);                   // ['123','456','789']

- KEY: reg.RegExp.replace
  EXPLAIN: ç½®æ›
  BODY: |
    â–  å®šç¾©
    const çµæœ = å¯¾è±¡æ–‡å­—åˆ—.replace(æ­£è¦è¡¨ç¾, "ç½®æ›æ–‡å­—åˆ—")

    const target = 'AB ABC BCD';
    const re = /AB/ig;
    const replaced = target.replace(re, "")

    â–  ç½®æ›ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    const target = 'AB ABC BCD';
    const re = /AB/ig;
    const replaced = target.replace(re, (substring?: string)=>{
      if(substring) return `[${substring}]`
      else return "null"
    })
    console.log(replaced)                         // "[AB] [AB]C BCD"

- KEY: reg.str.matchAll2022
  EXPLAIN: matchAll å…¨ä¸€è‡´ [ES2022]
  BODY: |
    const target = 'test1 test2';
    const re = /t(e)(st(\d?))/g;                  // g ãªã—ã ã¨ã‚¨ãƒ©ãƒ¼!!

    const array = [...target.matchAll(re)];
    array[0];                                     // ["test1", "e", "st1", "1"]
    array[1];                                     // ["test2", "e", "st2", "2"]

    const target = 'table football, foosball';
    const re = RegExp('foo[a-z]*','g');

    const hits = target.matchAll(re);
    console.log(hits);                            // {} ç©ºãªã®ã§è¦æ³¨æ„
    for (const hit of hits) {                     // å®Ÿéš›ã«ã¯å­˜åœ¨
      let idx = hit.index;
      console.log(`${hit[0]}: ${idx}~${idx + hit[0].length - 1}`);
    }

    const res = Array.from(                       // ["football", "foosball"]
      target.matchAll(re),
      m => m[0]
    );

- KEY: reg.flags
  EXPLAIN: ãƒ•ãƒ©ã‚°ä¸€è¦§
  BODY: |
    g  global(è¤‡æ•°ãƒãƒƒãƒ)
    i  ignoreCase(å¤§å°æ–‡å­—åŒºåˆ¥ãªã—)
    m  multiline(è¤‡æ•°è¡Œæ¤œç´¢)
    u  unicode(ã‚µãƒ­ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒšã‚¢ã‚’1æ–‡å­—ã¨ã—ã¦æ‰±ã†)
    y  sticky(lastIndexã§æŒ‡å®šã—ãŸä½ç½®ã‹ã‚‰æ¤œç´¢)
    s  dotAll([.]ãŒCR,LF,U+2028,U+2029ãªã©å…¨æ–‡å­—ãƒãƒƒãƒ)

- KEY: reg.flag.m
  EXPLAIN: m:æ”¹è¡Œã‚’è¡Œé ­è¡Œæœ«èªè­˜
  BODY: |
    è¡Œé ­(^)ã‚„è¡Œæœ«($)ãŒã€æ”¹è¡Œ(\n)å¾Œã®è¡Œé ­è¡Œæœ«ã«ã‚‚ãƒãƒƒãƒãƒ³ã‚°

    const target = 'ABC\nDEF\nGHI';
    target.match(/ABC$/);                         // null
    target.match(/ABC$/m);                        // ["ABC"]
    target.match(/^DEF/);                         // null
    target.match(/^DEF/m);                        // ["DEF"]
    target.match(/^DEF$/);                        // null
    target.match(/^DEF$/m);                       // ["DEF"]

- KEY: reg.flag.u
  EXPLAIN: u:ã‚µãƒ­ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒšã‚¢
  BODY: |
    U+10000ä»¥ä¸Šã®ã‚µãƒ­ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒšã‚¢é ˜åŸŸã®æ–‡å­—ã‚‚1æ–‡å­—

    console.log('ğŸ§²'.match(/^.$/));               // null (2æ–‡å­—ã ã‹ã‚‰)
    console.log('ğŸ§²'.match(/^.$/u));              // uãƒ•ãƒ©ã‚°(1æ–‡å­—ã¨ã—ã¦ä¸€è‡´)

- KEY: reg.flag.y
  EXPLAIN: y:lastIndexä½ç½®å›ºå®š
  BODY: |
    yãƒ•ãƒ©ã‚°: lastIndex ã®ä½ç½®ã‹ã‚‰ã‹ã‚‰å…ˆé ­ãƒãƒƒãƒãƒ³ã‚°ã§ä½ç½®ã‚’å›ºå®š(lastIndexãŒå…ˆã«é€²ã¾ãªã„)ã€‚
    gã‚’ã¤ã‘ã¦ã‚‚çµæœã¯ä¸€ã¤ã€‚æŒ™å‹•è¦æ³¨æ„

    const target = '123 456 789';
    const re = /[0-9]+/gy;                        // gãƒ•ãƒ©ã‚° + yãƒ•ãƒ©ã‚°
    re.lastIndex = 7;                             // lastIndexæŒ‡å®š(ä½ç½®å›ºå®š)

    let hit= null;
    hit= re.exec(target);
      console.log(hit, re.lastIndex);             // null, 0
    hit= re.exec(target);
      console.log(hit, re.lastIndex);             // ["123"], 3
    hit= re.exec(target);
      console.log(hit, re.lastIndex);             // null, 0
    hit= re.exec(target);
      console.log(hit, re.lastIndex);             // ["123"], 3

- KEY: reg.flag.s
  EXPLAIN: s:ãƒ‰ãƒƒãƒˆã‚’æ”¹è¡Œã«ã‚‚ä¸€è‡´
  BODY: |
    //.(ãƒ‰ãƒƒãƒˆ)ã‚’æ”¹è¡Œæ–‡å­—ã«ã‚‚ä¸€è‡´
    const target = "ABC\nDEF\nGHI";
    const re = /.+/g;                             // No sãƒ•ãƒ©ã‚°
    for (const hit of target.matchAll(re)) {
      console.log(hit, hit.index);                // ["ABC"],0 | ["DEF"],4 | ["GHI"],8 
    }

    const re = /.+/gs;                            // sãƒ•ãƒ©ã‚°
    for (const hit of target.matchAll(re)) {
      console.log(hit, hit.index);                // [""ABC\nDEF\nGHI""] 0
    }

- KEY: reg.matching
  EXPLAIN: ãƒãƒƒãƒãƒ³ã‚°è¡¨ç¾
  BODY: |
    x        xã¨ã„ã†æ–‡å­—
    xyz      å˜èªãƒãƒƒãƒ
    [xyz]    []å†…1æ–‡å­—
    [x-z]    xï½zã®1æ–‡å­—
    [^xyz]   x,y,zä»¥å¤–ã®1æ–‡å­—
    .        ä»»æ„ã®1æ–‡å­—(ä»¥ä¸‹ä»¥å¤–)
              Line Feed(\n), Carriage Return(\r),
              Line Separator(\u2028),Paragraph Separator(\u2029)
    ^x       xã§å§‹ã¾ã‚‹æ–‡å­—åˆ—
    x$       xã§çµ‚ã‚ã‚‹æ–‡å­—åˆ—
    x*?      0æ–‡å­—ä»¥ä¸Šã®x
    x+?      1æ–‡å­—ä»¥ä¸Šã®x
    x??      0æ–‡å­—ã¾ãŸã¯1æ–‡å­—ã®x
    x{n}?    nå€‹ã®x
    x{n,}?   nå€‹ä»¥ä¸Šã®x
    x{n,m}?  nå€‹ï½må€‹ã®x
    [\b]     ãƒãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚¹
    (?:x)    xã¨ã„ã†æ–‡å­—(å‚ç…§é™¤å¤–)
    x(?=y)   å…ˆèª­ã¿è¨€æ˜
    x(?!y)   å¦å®šå…ˆèª­ã¿è¨€æ˜
    (?<=x)y  å¾Œèª­ã¿è¨€æ˜
    (?<!x)y  å¦å®šå¾Œèª­ã¿è¨€æ˜

- KEY: reg.matching.x*?
  EXPLAIN: æœ€å¤§æœ€å°Match(*)
  BODY: |
    "<ABC><DEF>".match(/<.*>/)                    // ["<ABC><DEF>"]
    "<ABC><DEF>".match(/<.*?>/)                   // ["<ABC>"]

- KEY: reg.matching.x+?
  EXPLAIN: æœ€å¤§æœ€å°Match(+)
  BODY: |
    "<ABC><DEF>".match(/<.+>/)                    // ["<ABC><DEF>"]
    "<ABC><DEF>".match(/<.+?>/)                   // ["<ABC>"]

- KEY: reg.matching.x??
  EXPLAIN: æœ€å¤§æœ€å°Match(?)
  BODY: |
    "ABC".match(/AB?/)                            // ["AB"]
    "ABC".match(/AB??/)                           // ["A"]

- KEY: reg.matching.postfix
  EXPLAIN: å…ˆèª­ã¿è¨€æ˜
  BODY: |
    const target = 'CAT CAS CAN';

    const re = /(CA(?=S))/g;                      // CAã«ç¶šã"S"ãŒã‚ã‚‹å ´åˆã€CAã«ãƒãƒƒãƒ
    const hit1 = target.match(re);                // ["CA"]

    const re = /(CA(?=X))/g;                      // CAã«ç¶šã"X"ãŒã‚ã‚‹å ´åˆã€CAã«ãƒãƒƒãƒ
    const hit2 = target.match(re);                // null

- KEY: reg.matching.postfix.not
  EXPLAIN: å…ˆèª­ã¿è¨€æ˜(å¦å®š)
  BODY: |
    const target = 'CAT CAS';

    const re = /(CA(?!S))/g;                      // CAã«ç¶šã"S"ãŒãªã„å ´åˆã€CAã«ãƒãƒƒãƒã›ãš
    const hit1 = target.match(re);                // ["CA"] (CATã«ãƒãƒƒãƒ)

    const re = /(CA(?!X))/g;                      // CAã«ç¶šã"X"ãŒãªã„å ´åˆã€CAã«ãƒãƒƒãƒ
    const hit2 = target.match(re);                // ["CA", "CA"] (å…¨éƒ¨ã«ãƒãƒƒãƒ)

- KEY: reg.matching.prefix
  EXPLAIN: å¾Œèª­ã¿è¨€æ˜
  BODY: |
    const target = 'CAT CASE CAN CAST CAL';

    const re = /((?<=CA)S[^\s]*)/g;               // CAã«ç¶šã S[^\s] ã«ãƒãƒƒãƒ
    const hit= target.match(re);                  //  ["SE", "ST"]

- KEY: reg.matching.prefix.not
  EXPLAIN: å¾Œèª­ã¿è¨€æ˜(å¦å®š)
  BODY: |
    const target = 'CAT CASE MAST CAST RISK';

    const re = /((?<!CA)S[^\s]*)/g;               // CAã«ç¶šã‹ãªã„ S[^\s] ã«ãƒãƒƒãƒ
    const hit= target.match(re);                  // ["ST", "SK"]

- KEY: reg.specialChars
  EXPLAIN: ç‰¹æ®Šæ–‡å­—
  BODY: |
    \0     NULæ–‡å­—
    \b     å˜èªã®åŒºåˆ‡ã‚Šæ–‡å­—
    \B     \bä»¥å¤–ã®æ–‡å­—
    \cX    Ctrl-X(X ã«ã¯ A-Z ã®ã©ã‚Œã‹ã®æ–‡å­—)
    \d     åŠè§’æ•°å­—=[0-9]
    \D     \d ä»¥å¤–ã®æ–‡å­—=[^0-9]
    \f     æ”¹ãƒšãƒ¼ã‚¸(FF:Form-feed)
    \n     æ”¹è¡Œæ–‡å­—(LF:Line feed)
    \r     å¾©å¸°æ–‡å­—(CR:Carriage return)
    \s     1æ–‡å­—ã®ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹
    \S     ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹ä»¥å¤–ã®1æ–‡å­—
    \t     æ°´å¹³ã‚¿ãƒ–(HT:Horozontal tab)
    \v     å‚ç›´ã‚¿ãƒ–(VT:Vertical tab)
    \w     ã‚¢ãƒ³ãƒ€ãƒ¼ãƒãƒ¼(_)ã‚’å«ã‚€åŠè§’è‹±æ•°æ–‡å­—)=[A-Za-z0-9_]
    \W     \wä»¥å¤–ã®æ–‡å­— =[^A-Za-z0-9_]
    \n     nç•ªç›®ã® (...) ã«ãƒãƒƒãƒã—ãŸæ–‡å­—åˆ—
    \\\    \ohhh (é)8é€²æ•°ã§ hhh ã®æ–‡å­—
    \xhh   16é€²æ•°ã§ hh ã®æ–‡å­—

- KEY: reg.specialChar.b
  EXPLAIN: åŒºåˆ‡ã‚Šæ–‡å­—
  BODY: |
    "I like Java.".match(/\bJava\b/)              // ["Java"]
    "I like JavaScript.".match(/\bJava\b/)        // null
    "I like JavaScript.".match(/\bJava/)          // ["Java"]

- KEY: reg.specialChars.unicode
  EXPLAIN: ç‰¹æ®Šæ–‡å­—(Unicode)
  BODY: |
    \uhhhh             UTF-16 Unicodeæ–‡å­—
    \u{hhhh}           éã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢é ˜åŸŸã® UTF-16 Unicodeæ–‡å­—ã€gãƒ•ãƒ©ã‚°æŒ‡å®šæ™‚ã®ã¿åˆ©ç”¨å¯èƒ½
    \u{hhhhh}          ã‚µãƒ­ã‚²ãƒ¼ãƒˆãƒšã‚¢é ˜åŸŸã® UTF-16 Unicodeæ–‡å­—ã€gãƒ•ãƒ©ã‚°æŒ‡å®šæ™‚ã®ã¿åˆ©ç”¨å¯èƒ½
    \p{property}       Binaryãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã« propety ã‚’æŒã¤æ–‡å­—(è¦u:ES2018)
    \P{property}       Binaryãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã« propety ã‚’æŒãŸãªã„æ–‡å­—(è¦u:ES2018)
    \p{gc=property}    General_Category ã« propety ã‚’æŒã¤æ–‡å­—(è¦u:ES2018)
    \P{gc=property}    General_Category ã« propety ã‚’æŒãŸãªã„æ–‡å­—(è¦u:ES2018)
    \p{sc=property}    Script ãŒ propety ã«ãƒãƒƒãƒã™ã‚‹æ–‡å­—(è¦u:ES2018)
    \p{sc=Hiragana}    Script ãŒ ã²ã‚‰ãŒãª ã«ãƒãƒƒãƒã™ã‚‹æ–‡å­—(è¦u:ES2018)
    \P{sc=property}    Script ãŒ propety ã«ãƒãƒƒãƒã—ãªã„æ–‡å­—(è¦u:ES2018)
    \p{scx=property}   Script_Extensions ãŒ propety ã«ãƒãƒƒãƒã™ã‚‹æ–‡å­—(è¦u:ES2018)
    \P{scx=property}   Script_Extensions ãŒ propety ã«ãƒãƒƒãƒã—ãªã„æ–‡å­—(è¦u:ES2018)

- KEY: reg.sample.postalCode
  EXPLAIN: éƒµä¾¿ç•ªå·
  BODY: |
    â–  éƒµä¾¿ç•ªå·(ãƒã‚¤ãƒ•ãƒ³ãªã—)
    const re = /^\d{7}$/
    re.test("1234567".trim())                     // true
    re.test("1234567 ".trim())                    // true
    re.test("123456".trim())                      // false
    re.test("A123456".trim())                     // false

    â–  éƒµä¾¿ç•ªå·(ãƒã‚¤ãƒ•ãƒ³ã‚ã‚Š)
    const re = /^[0-9]{3}-[0-9]{4}$/
    re.test("111-1111".trim())                    // true
    re.test("111-1111 ".trim())                   // true
    re.test("1111-111".trim())                    // false
    re.test("11A-1111".trim())                    // false

    â–  éƒµä¾¿ç•ªå·(ãƒã‚¤ãƒ•ãƒ³ä»»æ„)
    const re = /^[0-9]{3}-?[0-9]{4}$/
    re.test("123-4567".trim())                    // true
    re.test("1234567".trim())                     // true
    re.test("1234-567".trim())                    // false
    re.test("1234A67".trim())                     // false

- KEY: reg.sample.phoneNumber
  EXPLAIN: é›»è©±ç•ªå·(å›ºå®š)
  BODY: |
    â–  é›»è©±ç•ªå·(ãƒã‚¤ãƒ•ãƒ³ã‚ã‚Š)
    const re = /\d{2,4}-\d{2,4}-\d{4}/
    re.test("03-1234-5678".trim())                // true
    re.test("030-2340-5678".trim())               // true
    re.test("0301-240-5678".trim())               // true
    re.test("0301-2400-567".trim())               // false
    re.test("030-2340-5678 ".trim())              // true
    re.test("030-2 40-5678".trim())               // false

    â–  é›»è©±ç•ªå·(ãƒã‚¤ãƒ•ãƒ³ãªã—)
    const re = /^(0{1}\d{9,10})$/
    re.test("0312345678".trim())                  // true
    re.test("0312345A78 ".trim())                 // false
    re.test("03012345678 ".trim())                // true
    re.test("031234568".trim())                   // false
    re.test("03-12345A78".trim())                 // false

- KEY: reg.sample.phoneNumberCell
  EXPLAIN: é›»è©±ç•ªå·(æºå¸¯)
  BODY: |
    â–  æºå¸¯ç•ªå·(ãƒã‚¤ãƒ•ãƒ³ã‚ã‚Š)1
    const re = /^0[5789]0-[0-9]{4}-[0-9]{4}$/
    re.test("080-1234-5678".trim())               // true
    re.test("080-1234-5678 ".trim())              // true
    re.test("080-123-45678 ".trim())              // false

    â–  æºå¸¯ç•ªå·(ãƒã‚¤ãƒ•ãƒ³ã‚ã‚Š)2
    const re = /^(050|070|080|090)-\d{4}-\d{4}$/
    re.test("080-1234-5678".trim())               // true
    re.test("080-1234-5678 ".trim())              // true
    re.test("060-1234-5678 ".trim())              // false
