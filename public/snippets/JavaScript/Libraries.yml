---
#-------------------------------
# JavaScript
#-------------------------------

#-------------------------------
# libraries（数学）
#-------------------------------
- ENTRY:
  CATEGORY: NPM ライブラリ

- ENTRY:
  EXPLAIN: npm 検索
  BODY: |
    https://www.npmjs.com/

- ENTRY:
  EXPLAIN: |
    エクセル: formulajs
  BODY: |
    ■ Microsoft Excel関数のJavaScript実装を構築

    officail: https://formulajs.info/
    github: 
    npm:    https://www.npmjs.com/package/@formulajs/formulajs
    cdn:    <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.2/dist/jstat.min.js"></script>

    ■ Install
    npm i @formulajs/formulajs

- ENTRY:
  EXPLAIN: |
    統計: simple-statistics
  BODY: |
    github: https://github.com/simple-statistics/simple-statistics
    URL:    https://simple-statistics.github.io/docs/

    // IMPORT
    import * as ss from 'simple-statistics'
    import {min} from 'simple-statistics'

#-------------------------------
# libraries（数学）
#-------------------------------
- ENTRY:
  CATEGORY: 数学ライブラリ

- ENTRY:
  EXPLAIN: 四捨五入
  BODY: |
    /**
    * 四捨五入
    * @param value 数値
    * @param fp 整数:少数点,マイナスで任意の桁
    * @returns 四捨五入された数値
    */
    const round = (value: number, fp = 0) => {
      const k = value < 0 ? -1 : 1
      return (k * Math.round(value * k * 10 ** fp)) / 10 ** fp
    }

- ENTRY:
  EXPLAIN: 切り上げ
  BODY: |
    /**
    * 切り上げ
    * @param value 数値
    * @param fp 整数:少数点,マイナスで任意の桁
    * @returns 切り上げされた数値
    */
    const roundUp = (value: number, fp = 0) => {
      const k = value < 0 ? -1 : 1
      return (k * Math.ceil(value * k * 10 ** fp)) / 10 ** fp
    }

- ENTRY:
  EXPLAIN: 切り下げ
  BODY: |
    /**
    * 切り下げ
    * @param value 数値
    * @param fp 整数:少数点,マイナスで任意の桁
    * @returns 切り下げされた数値
    */
    const roundDown = (value: number, fp = 0) => {
      const k = value < 0 ? -1 : 1
      return (k * Math.floor(value * k * 10 ** fp)) / 10 ** fp
    }

- ENTRY:
  EXPLAIN: Excel Ceiling
  BODY: |
    /**
    * Excel Ceiling(指定基準値の最も近い倍数に数値切り上げ)
    * @param value 数値
    * @param significance 倍数の基準値
    *    以下、エクセルと仕様一致
    *    1) 0値では 0 を返す
    *    2) マイナス値では null を返す
    * @param fp 整数:少数点
    * @returns 切り上げ後、丸め誤差を削除した数値
    */
    const ceiling = (target: number, significance: number, fp: number) => {
      if (significance === 0) return 0
      if (significance < 0) return null
      return (
        Math.round(Math.ceil(target / significance) * significance * 10 ** fp) /
        10 ** fp
      )
    }

- ENTRY:
  EXPLAIN: MIN & MAX(文字列)
  BODY: |
    /**
    * MIN & MAX
    * @param 文字列数字配列(["","20","10"]) 空文字対応
    * @returns 空白や０以外で最も MIN/MAX を"数値"で返す
    *
    * エクセルの MIN(PARAM1[, PARAM2,...])は空白を除外するが、
    * JSの Math.min関数は0も精査するので、簡単な置換では戻り値に違いがでる
    */

    function min(...args: string[]) {
      return args.reduce((acc, cur) => {
        const curNum = Number(cur)
        if (isNaN(curNum) || cur === "") return acc
        return acc === null || (acc !== null && acc > curNum) ? curNum : acc
      }, null as null | number)
    }

    function max(...args: string[]) {
      return args.reduce((acc, cur) => {
        const curNum = Number(cur)
        if (isNaN(curNum) || cur === "") return acc
        return acc === null || (acc !== null && acc < curNum) ? curNum : acc
      }, null as null | number)
    }

#-------------------------------
# JSON: CSV => JSON
#-------------------------------

- ENTRY:
  CATEGORY: CSV

#-------------------------------
# JSON: CSV => JSON
#-------------------------------
- ENTRY:
  EXPLAIN: CSV => JSON 変換メソッド
  BODY: |
    //改善の余地が大きい（最初の行のヘッダ有無確認必要）

    const convertCsv2Json = (text: string, headers: string[], div = "\t") => {
      //数字の1,000,000桁区切りコンマを削除
      const re = new RegExp(",", "ig"); 

      const jsonArr: { [key: string]: string }[] = [];
      text
        .split("\n")
        .filter(Boolean)
        .forEach((line) => {
          const obj: { [key: string]: string } = {};

          line.split(div).forEach((v, i) => {
            //文字と数値の違いで挙動を変えること
            obj[headers[i]] = v.trim().replace(re, "");
          });
          jsonArr.push(obj);
        });
      return jsonArr;
    };

    // SAMPLE
    const TABLE_TITLE_配列 = ["DO検索用", "検索エリア", "DO値"] as const;
    type TABLE_KEY = (typeof TABLE_TITLE_配列)[number];
    type TABLE_型 = Record<TABLE_KEY, string>;

    const TABLE_DATA = `
    0	1	≦20
    20	2	20～40
    40	3	40～50
    50	4	50～60
    60	5	60～100
    100	6	100～140
    140	7	140～200
    200	8	≧200
    `;

    const table = convertCsv2Json(
      TABLE_DATA,
      TABLE_TITLE_配列 as unknown as string[],
    ) as TABLE_型[];
